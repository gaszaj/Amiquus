---
import BaseLayout from '../../../layouts/BaseLayout.astro';
import articleDataJson from '../../../data/article.json';
import wwwData from '../../../data/www.json';
import commonData from '../../../data/common.json';

// --- Type Definitions for Props (originally from ArticleLayout.astro) ---
export interface AuthorInfo {
  name: string;
  profileUrl: string;
  image: string;
}

export interface HeadingInfo {
  depth: number;
  slug: string;
  text: string;
}

export interface RelatedArticleInfo { // This replaces the imported ArticleLayout_RelatedArticleInfo
  title: string;
  url: string;
  date: string;
}

// --- Content Props for Sections (originally from ArticleLayout.astro) ---
export interface TocContent {
  title: string;
}

export interface EditorialPolicyContent {
  title: string;
  description: string;
  ctaText: string;
  ctaLink: string;
}

export interface DisclaimerContent {
  text: string;
}

export interface RelatedArticlesContent { // Used for relatedArticlesForPage structure
  title: string;
  articles: RelatedArticleInfo[];
}

export interface HelpBoxContent {
  title: string;
  description: string;
  ctaText: string;
  ctaLink: string;
}

export interface BasicSign {
  name: string;
  image: string;
  url: string;
}

export interface AdditionalSign {
  image: string;
  name: string;
  url: string;
}

export interface FaqItem {
  question: string;
  answer: string;
}

export interface FaqSection {
  title: string;
  items: FaqItem[];
}

export const prerender = false;

const { ArticlelistSlug, articleSlug } = Astro.params;

const article = articleDataJson.find(
  (entry: ArticleJsonEntry) => entry.ARTICLE_SLUG === articleSlug
);

if (!article || article.PUBLISH_Y_N !== "1" || article.ARTICLE_LIST_SLUG !== ArticlelistSlug) {
  return Astro.redirect('/404');
}

const www = wwwData[0];
const common = commonData[0];

// Helper function for absolute URLs with locale
const getAbsoluteUrl = (path: string): string => {
    const locale = Astro.url.pathname.split('/')[1];
    return new URL(`/${locale}${path}`, Astro.url.origin).toString();
};

// Helper function for base-level URLs (without locale)
const getBaseUrl = (path: string): string => {
    return new URL(path, Astro.url.origin).toString();
};

// Get language data
const languageIso = article.M_LANGUAGE_ISO;
const countryCode = article.M_COUNTRY_CODE;

// Find matching content orientation from common.json
const contentOrientation = commonData.find(item =>
  item.M_LANGUAGE_ISO === languageIso &&
  item.M_COUNTRY_CODE === countryCode
)?.M_CONTENT_ORIENTATION || 'ltr'; // Default to 'ltr' if no match found

// --- Article Specific Metadata ---
const articleMetadata = {
  seoTitle: article.ARTICLE_PAGE_TITLE,
  h1: article.ARTICLE_H1,
  description: article.ARTICLE_META_SEO,
  ogImage: article.ARTICLE_OG_IMAGE_PATH,
  publishDate: article.ARTICLE_PUBLISH_DATE,
  updateDate: article.ARTICLE_UPDATE_DATE,
  author: {
    name: article.ARTICLE_AUTHOR_NAME,
    profileUrl: article.ARTICLE_AUTHOR_PROFILE_URL,
    image: article.ARTICLE_AUTHOR_IMAGE
  } as AuthorInfo,
  headings: [
    { depth: 2, slug: common.ARTICLE_H2_1_ID, text: article.ARTICLE_H2_1 },
    { depth: 3, slug: common.ARTICLE_H2_2_ID, text: article.ARTICLE_H2_2 },
    { depth: 2, slug: common.ARTICLE_H2_3_ID, text: article.ARTICLE_H2_3 },
    { depth: 3, slug: common.ARTICLE_H2_4_ID, text: article.ARTICLE_H2_4 },
    { depth: 2, slug: common.ARTICLE_H2_5_ID, text: article.ARTICLE_H2_5 },
    { depth: 2, slug: common.ARTICLE_H2_6_ID, text: article.ARTICLE_H2_6 },
    { depth: 2, slug: common.ARTICLE_H2_7_ID, text: article.ARTICLE_H2_7 }
  ] as HeadingInfo[]
};

// --- Content for Layout Sections & UI Text ---
const layoutContent = { // This data was previously passed as props to ArticleLayout
  authorLabelText: common.ARTICLE_AUTHOR_LABEL,
  publishedLabelText: common.ARTICLE_PUBLISHED_LABEL,
  updatedLabelText: common.ARTICLE_UPDATED_LABEL,
  mainDateLocale: `${article.M_LANGUAGE_ISO}-${article.M_COUNTRY_CODE}`,
  mainDateFormatOptions: { year: 'numeric', month: 'long', day: 'numeric' } as Intl.DateTimeFormatOptions,
  relatedDateLocale: `${article.M_LANGUAGE_ISO}-${article.M_COUNTRY_CODE}`,
  relatedDateFormatOptions: { year: 'numeric', month: 'short', day: 'numeric' } as Intl.DateTimeFormatOptions,
  tocContent: {
    title: common.ARTICLE_TOC_TITLE
  } as TocContent,
  editorialPolicyContent: {
    title: common.ARTICLE_EDITORIAL_POLICY_TITLE,
    description: common.ARTICLE_EDITORIAL_POLICY_DESC,
    ctaText: common.ARTICLE_EDITORIAL_POLICY_CTA,
    ctaLink: article.ARTICLE_EDITORIAL_INTERNAL_LINK
  } as EditorialPolicyContent,
  disclaimerContent: {
    text: common.ARTICLE_DISCLAIMER
  } as DisclaimerContent,
  helpBoxContent: {
    title: common.ARTICLE_HELP_BOX_TITLE,
    description: common.ARTICLE_HELP_BOX_DESC,
    ctaText: common.ARTICLE_HELP_BOX_CTA,
    ctaLink: `mailto:${www.PAGE_INFO_EMAIL}`
  } as HelpBoxContent
};

// Define keywords for the page
const pageKeywords = [
  article.ARTICLE_H1,
  www.M_COUNTRY_NATIVE,
  www.PAGE_ORGANISATION_FULL_NAME
].join(', ');


// --- Related Articles Data and Logic ---
const allDomainArticles: RelatedArticleInfo[] = [
  { title: "Varnost, oznaƒçevanje in opozarjanje pri teka≈°kih dogodkih", url: "/articles/safety-signs-visibility-night", date: "2025-03-15" },
  { title: "Varnost, oznaƒçevanje in opozarjanje pri ≈°portnih dogodkih", url: "/articles/eu-regulations-road-warning-systems", date: "2025-03-10" },
  { title: "Varnost, oznaƒçevanje in opozarjanje pri kolesarskih dirkah", url: "/articles/maintain-triopan-warning-signs", date: "2025-03-05" },
  { title: "Varnost, oznaƒçevanje in opozarjanje pri ≈°portnih turnirjih", url: "/articles/warning-signs-construction-sites", date: "2025-02-28" },
  { title: "Varnost, oznaƒçevanje in opozarjanje pri ≈°portnih dnevih", url: "/articles/event-safety-warning-systems", date: "2025-02-20" },
  { title: "Varnost, oznaƒçevanje in opozarjanje pri ≈°olskih tekmovanjih", url: "/articles/highway-work-zone-safety", date: "2025-02-15" },
  { title: "Varnost, oznaƒçevanje in opozarjanje pri javnih prireditvah", url: "/articles/emergency-response-warning-systems", date: "2025-02-10" },
  { title: "Varnost, oznaƒçevanje in opozarjanje pri ≈°portnih objektih", url: "/articles/safety-sign-technology-innovation", date: "2025-02-05" }
];

const relatedArticlesForPage: RelatedArticlesContent = { // Structure matches RelatedArticlesContent
  title: common.ARTICLE_RELATED_ARTICLES,
  articles: allDomainArticles
    .filter(articleItem => articleItem.title !== articleMetadata.h1)
    .slice(0, 9)
};

// --- Product Data (specific to this article's content) ---
const basicSigns: BasicSign[] = [
  { name: article.ARTICLE_SIGN_1_NAME, image: article.ARTICLE_SIGN_1_IMAGE, url: article.ARTICLE_SIGN_1_URL },
  { name: article.ARTICLE_SIGN_2_NAME, image: article.ARTICLE_SIGN_2_IMAGE, url: article.ARTICLE_SIGN_2_URL },
  { name: article.ARTICLE_SIGN_3_NAME, image: article.ARTICLE_SIGN_3_IMAGE, url: article.ARTICLE_SIGN_3_URL }
];

const additionalSigns: AdditionalSign[] = [
  {
    image: article.ARTICLE_ADD_SIGN_1_IMAGE,
    name: article.ARTICLE_ADD_SIGN_1_NAME,
    url: article.ARTICLE_ADD_SIGN_1_URL
  },
  {
    image: "/productimg/s/triopan-pozor-viliƒçar.webp",
    name: "Opozorilna piramida DELO NA CESTI 250m",
    url: "/si/opozorilna-piramida/delo-na-cesti-250m"
  },
  {
    image: "/productimg/s/triopan-delo-na-cesti.webp",
    name: "Opozorilna piramida DELO NA CESTI 500m",
    url: "/si/opozorilna-piramida/delo-na-cesti-500m"
  },
  {
    image: "/productimg/s/triopan-parkirni-prostor.webp",
    name: "Opozorilna piramida OBVOZ",
    url: "/si/opozorilna-piramida/obvoz"
  },
  {
    image: "/productimg/s/triopan-≈°olska-pot.webp",
    name: "Opozorilna piramida ≈†OLSKA POT",
    url: "/si/opozorilna-piramida/≈°olska-pot"
  },
  {
    image: "/productimg/s/triopan-zo≈æenje-z-desne.webp",
    name: "Opozorilna piramida ZO≈ΩENJE Z DESNE",
    url: "/si/opozorilna-piramida/zozenje-z-desne"
  },
  {
    image: "/productimg/s/triopan-zo≈æenje-z-leve.webp",
    name: "Opozorilna piramida ZO≈ΩENJE Z LEVE",
    url: "/si/opozorilna-piramida/zozenje-z-leve"
  },
  {
    image: "/productimg/s/triopan-omejitev-hitrosti-10.webp",
    name: "Opozorilna piramida OMEJITEV HITROSTI",
    url: "/si/opozorilna-piramida/omejitev-hitrosti"
  }
];

// --- FAQ Data Structure ---
const faqSection: FaqSection = {
  title: article.ARTICLE_H2_6, // This text is used for the H2 of the FAQ section
  items: [
    {
      question: article.ARTICLE_FAQ_Q1,
      answer: article.ARTICLE_FAQ_A1
    },
    {
      question: article.ARTICLE_FAQ_Q2,
      answer: article.ARTICLE_FAQ_A2
    },
    {
      question: article.ARTICLE_FAQ_Q3,
      answer: article.ARTICLE_FAQ_A3
    }
  ]
};

const productButtonText = common.ARTICLE_PRODUCT_BUTTON;
const tableLinkText = common.ARTICLE_TABLE_LINK;

// --- Article Schema ---
const articleSchema = {
  "@context": "https://schema.org",
  "@type": "WebPage",
  "name": articleMetadata.seoTitle,
  "url": Astro.url.href,
  "description": articleMetadata.description,
  "inLanguage": `${article.M_LANGUAGE_ISO}-${article.M_COUNTRY_CODE}`,
  "breadcrumb": {
    "@type": "BreadcrumbList",
    "itemListElement": [
      {
        "@type": "ListItem",
        "position": 1,
        "name": article.M_HOME_NAME,
        "item": getBaseUrl('/')
      },
      {
        "@type": "ListItem",
        "position": 2,
        "name": ArticlelistSlug,
        "item": getAbsoluteUrl(`/${ArticlelistSlug}`)
      },
      {
        "@type": "ListItem",
        "position": 3,
        "name": articleMetadata.seoTitle,
        "item": Astro.url.href
      }
    ]
  },
  "mainEntity": {
    "@type": "Article",
    "headline": articleMetadata.h1,
    "description": articleMetadata.description,
    "image": getBaseUrl(articleMetadata.ogImage),
    "author": {
      "@type": "Person",
      "name": articleMetadata.author.name,
      "image": getBaseUrl(articleMetadata.author.image),
      "url": getAbsoluteUrl(articleMetadata.author.profileUrl)
    },
    "datePublished": articleMetadata.publishDate,
    "dateModified": articleMetadata.updateDate,
    "inLanguage": `${article.M_LANGUAGE_ISO}-${article.M_COUNTRY_CODE}`
  }
};

// FAQ Schema
const faqSchema = {
  "@context": "https://schema.org",
  "@type": "FAQPage",
  "mainEntity": faqSection.items.map(item => ({
    "@type": "Question",
    "name": item.question,
    "acceptedAnswer": {
      "@type": "Answer",
      "text": item.answer
    }
  }))
};

// Organization Schema
const organizationSchema = {
  "@context": "https://schema.org",
  "@type": "Organization",
  "name": www.PAGE_ORGANISATION_FULL_NAME,
  "url": getBaseUrl('/'),
  "foundingDate": www.PAGE_FOUNDING_DATE,
  "logo": getBaseUrl(www.PAGE_LOGO_IMAGE_PATH_1),
  "keywords": [
    www.PAGE_ORGANISATION_FULL_NAME,
    www.M_COUNTRY_NATIVE,
    common.PAGE_KEYWORD_1,
    common.PAGE_KEYWORD_2,
    common.PAGE_KEYWORD_3,
    common.PAGE_KEYWORD_4,
    common.PAGE_KEYWORD_5,
    common.PAGE_KEYWORD_6
  ],
  "description": www.PAGE_DESCRIPTION,
  "numberOfEmployees": {
    "@type": "QuantitativeValue",
    "minValue": "1",
    "maxValue": "9"
  },
  "slogan": www.PAGE_SLOGAN,
  "contactPoint": {
    "@type": "ContactPoint",
    "email": www.PAGE_INFO_EMAIL,
    "contactType": common.M_CUSTOMER_SUPPORT
  },
  "sameAs": [
    www.PAGE_INSTAGRAM_URL,
    www.PAGE_FACEBOOK_URL,
    www.PAGE_TWITTER_URL,
    www.PAGE_LINKEDIN_URL,
    www.PAGE_YOUTUBE_URL,
    www.PAGE_PINTEREST_URL,
    www.PAGE_BLUESKY_URL
  ],
  "areaServed": {
    "@type": "Country",
    "name": www.M_COUNTRY,
    "identifier": www.M_COUNTRY_CODE
  },
  "potentialAction": [
    {
      "@type": "ViewAction",
      "name": www.PAGE_MASTER_SITEMAP_INSTRUCTIONS,
      "target": getBaseUrl('/sitemap.xml')
    },
    {
      "@type": "ViewAction",
      "name": www.PAGE_LOCAL_SITEMAP_INSTRUCTIONS,
      "target": getBaseUrl(`/sitemap-${languageIso}-${countryCode}.xml`)
    },
    {
      "@type": "ViewAction",
      "name": www.PAGE_LLM_INSTRUCTIONS,
      "target": getBaseUrl('/llms.txt'),
      "description": www.PAGE_LLM_INSTRUCTIONS_DESCRIPTION
    }
  ],
  "mainEntityOfPage": [
    {
      "@type": "WebPage",
      "@id": getBaseUrl('/sitemap.xml'),
      "name": www.PAGE_MASTER_SITEMAP_INSTRUCTIONS,
      "description": www.PAGE_MASTER_SITEMAP_INSTRUCTIONS_DESCRIPTION
    },
    {
      "@type": "WebPage",
      "@id": getBaseUrl(`/sitemap-${languageIso}-${countryCode}.xml`),
      "name": www.PAGE_LOCAL_SITEMAP_INSTRUCTIONS,
      "description": www.PAGE_LOCAL_SITEMAP_INSTRUCTIONS_DESCRIPTION
    },
    {
      "@type": "WebPage",
      "@id": getBaseUrl('/llms.txt'),
      "name": www.PAGE_LLM_INSTRUCTIONS,
      "description": www.PAGE_LLM_INSTRUCTIONS_DESCRIPTION
    }
  ]
};

// Combine all schemas
const combinedSchema = [articleSchema, faqSchema, organizationSchema];

const mainContent = { // Content for the main article body
  h1: {
    text: article.ARTICLE_H1,
    content: article.ARTICLE_MAIN_CONTENT_1
  },
  h2_1: {
    text: article.ARTICLE_H2_1,
    content: article.ARTICLE_MAIN_CONTENT_2,
    conclusion: article.ARTICLE_MAIN_CONTENT_3
  },
  h2_2: {
    text: article.ARTICLE_H2_2,
    content: article.ARTICLE_MAIN_CONTENT_4
  },
  h2_3: {
    text: article.ARTICLE_H2_3,
    content: article.ARTICLE_MAIN_CONTENT_5
  },
  h2_4: {
    text: article.ARTICLE_H2_4,
    content: article.ARTICLE_MAIN_CONTENT_6
  },
  // h2_5 content is handled by faqSection structure
  h2_6: {
    text: article.ARTICLE_H2_6,
    content: article.ARTICLE_MAIN_CONTENT_7
  }
};

// Table headers
const tableHeaders = {
    image: common.ARTICLE_TABLE_HEADER_IMAGE,
    name: common.ARTICLE_TABLE_HEADER_NAME,
    link: common.ARTICLE_TABLE_HEADER_LINK
};


// Generic Date Formatter
const formatDate = (dateString: string, locale: string, options: Intl.DateTimeFormatOptions) => {
  return new Date(dateString).toLocaleDateString(locale, options);
};

// Filter headings for TOC
const tocHeadings = articleMetadata.headings.filter(heading => heading.depth >= 2 && heading.depth <= 3);
---

<BaseLayout
  languageIso={languageIso}
  countryCode={countryCode}
  contentOrientation={contentOrientation}
  title={articleMetadata.seoTitle}
  description={articleMetadata.description}
  ogImage={articleMetadata.ogImage}
  keywords={pageKeywords}
  schema={combinedSchema}
>
  <!-- Hero Section with Dark Background -->
  <header class="bg-black text-white py-12">
    <div class="container mx-auto px-4">
      <div class="max-w-3xl animate-fade-in">
        <h1 class="text-4xl md:text-5xl font-bold mb-4">{articleMetadata.h1}</h1>

        {article.ARTICLE_SUBTITLE && (
          <p class="text-xl text-gray-300 mb-6">{article.ARTICLE_SUBTITLE}</p>
        )}

        <div class="flex flex-col sm:flex-row flex-wrap gap-2 sm:items-center">
          <div class="flex items-center">
            <span class="text-gray-300 mr-2">{layoutContent.authorLabelText}</span>
            <a href={articleMetadata.author.profileUrl} class="flex items-center group">
              <img
                src={articleMetadata.author.image}
                alt={articleMetadata.author.name}
                class="w-10 h-10 rounded-full mr-3"
                width={200}
                height={200}
                fetchpriority="high"
              />
              <span class="text-white group-hover:text-signal-green transition-colors">
                {articleMetadata.author.name}
              </span>
            </a>
          </div>
          <div class="flex items-center">
            <span class="hidden sm:inline mx-2 text-gray-300">‚Ä¢</span>
            <span class="text-gray-300">{layoutContent.publishedLabelText} {formatDate(articleMetadata.publishDate, layoutContent.mainDateLocale, layoutContent.mainDateFormatOptions)}</span>
          </div>
          {articleMetadata.updateDate && layoutContent.updatedLabelText && (
            <div class="flex items-center">
              <span class="hidden sm:inline mx-2 text-gray-300">‚Ä¢</span>
              <span class="text-gray-300">
                {layoutContent.updatedLabelText} {formatDate(articleMetadata.updateDate, layoutContent.mainDateLocale, layoutContent.mainDateFormatOptions)}
              </span>
            </div>
          )}
        </div>
      </div>
    </div>
  </header>

  <div class="container mx-auto px-4 py-8">
    <div class="flex flex-col lg:flex-row gap-8">
      <!-- Left Sidebar - Table of Contents -->
      <aside class="lg:w-1/5">
        <div class="sticky top-24">
          {tocHeadings.length > 0 && (
            <nav class="bg-white rounded-lg shadow-sm p-4 border border-gray-100" aria-labelledby="toc-heading">
              <h2 id="toc-heading" class="text-lg font-semibold text-signal-dark mb-2 pb-2 border-b">{layoutContent.tocContent.title}</h2>
              <ul class="space-y-1">
                {tocHeadings.map(heading => (
                  <li class={`${heading.depth === 2 ? 'mt-2 first:mt-0' : 'ml-3'}`}>
                    <a
                      href={`#${heading.slug}`}
                      class={`toc-link block py-1.5 px-2 rounded transition-colors text-sm
                        ${heading.depth === 2
                          ? 'text-signal-dark font-medium hover:bg-gray-50 border-l-2 border-transparent'
                          : 'text-signal-gray hover:text-signal-green'}`}
                    >
                      {heading.text}
                    </a>
                  </li>
                ))}
              </ul>
            </nav>
          )}
        </div>
      </aside>

      <!-- Main article content container -->
      <article class="lg:w-3/5">
        <div class="prose prose-lg max-w-none">

            <h2>{article.ARTICLE_H2_1}</h2>
            <p>{mainContent.h1.content}</p>
            <div class="fear-banner">
              {article.ARTICLE_FEAR_BANNER}
            </div>
          </section>

          <section id={common.ARTICLE_H2_2_ID}>
            <h3>{article.ARTICLE_H2_2}</h3>
            <p>{mainContent.h2_1.content}</p>
            <div class="basic-signs-grid">
              {basicSigns.map(sign => (
                <div class="product-card">
                  <img
                    src={sign.image}
                    alt={sign.name}
                    class="w-full h-48 object-contain p-4"
                  />
                  <div class="p-4 text-center product-card-content">
                    <h4 class="font-medium text-signal-dark mb-4 product-title">{sign.name}</h4>
                    <a
                      href={sign.url}
                      class="block w-full bg-black text-signal-green border border-signal-green font-medium py-2 px-4 rounded-md hover:bg-signal-green hover:text-black transition-all text-center"
                    >
                      {productButtonText}
                    </a>
                  </div>
                </div>
              ))}
            </div>
            {mainContent.h2_1.conclusion && <p>{mainContent.h2_1.conclusion}</p>}
          </section>

          {/* Section for H2_2 (actual H2 tag in HTML) */}
          <section id={common.ARTICLE_H2_3_ID}>
            <h2>{article.ARTICLE_H2_3}</h2>
            <p>{mainContent.h2_2.content}</p>
          </section>

          {/* Section for H2_3 (actual H3 tag in HTML) */}
          <section id={common.ARTICLE_H2_4_ID}>
            <h3>{article.ARTICLE_H2_4}</h3>
            <div class="overflow-x-auto my-8">
              <table class="w-full bg-white rounded-lg shadow-sm">
                <thead class="bg-gray-50">
                  <tr>
                    <th class="p-4 text-left">{tableHeaders.image}</th>
                    <th class="p-4 text-left">{tableHeaders.name}</th>
                    <th class="p-4 text-left">{tableHeaders.link}</th>
                  </tr>
                </thead>
                <tbody>
                  {additionalSigns.map((sign, index) => (
                    <tr class={index % 2 === 0 ? 'bg-gray-50' : ''}>
                      <td class="p-4">
                        <img
                          src={sign.image}
                          alt={sign.name}
                          class="w-20 h-20 object-contain"
                        />
                      </td>
                      <td class="p-4 font-medium text-signal-dark">{sign.name}</td>
                      <td class="p-4">
                        <a
                          href={sign.url}
                          class="text-black underline decoration-signal-green hover:text-signal-green hover:decoration-black transition-colors"
                        >
                          {tableLinkText}
                        </a>
                      </td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
            <p>{mainContent.h2_3.content}</p>
            {mainContent.h2_3.conclusion && <p>{mainContent.h2_3.conclusion}</p>}
          </section>

          {/* Section for H2_4 (actual H2 tag in HTML) */}
          <section id={common.ARTICLE_H2_5_ID}>
            <h2>{article.ARTICLE_H2_5}</h2>
            <p>{mainContent.h2_4.content}</p>
            <div class="helpful-banner">
              {article.ARTICLE_HELPFUL_BANNER}
            </div>
          </section>

          {/* FAQ Section */}
          <section id={common.ARTICLE_H2_6_ID} class="py-16 bg-white">
            <div class="container mx-auto px-4">
              <h2 class="text-3xl font-bold text-black mb-4 text-center">{faqSection.title}</h2>
              <div class="max-w-3xl mx-auto space-y-4">
                {faqSection.items.map(item => (
                  <details class="bg-gray-50 rounded-lg group">
                    <summary class="p-4 cursor-pointer font-medium flex items-center justify-between">
                      <span>{item.question}</span>
                      <svg 
                        class="w-5 h-5 transform transition-transform group-open:rotate-180 faq-chevron" 
                        fill="none" 
                        stroke="currentColor" 
                        viewBox="0 0 24 24"
                      >
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                      </svg>
                    </summary>
                    <div class="p-4 pt-0 text-gray-600">
                      {item.answer}
                    </div>
                  </details>
                ))}
              </div>
            </div>
          </section>

          {/* Section for H2_6 (actual H3 tag in HTML) */}
          <section id={common.ARTICLE_H2_7_ID}>
            <h3>{article.ARTICLE_H2_7}</h3>
            <p>{mainContent.h2_6.content}</p>
            <div class="basic-signs-grid">
              {[...basicSigns, ...additionalSigns.slice(0, 3)].map(sign => (
                <div class="product-card">
                  <img
                    src={sign.image}
                    alt={sign.name}
                    class="w-full h-48 object-contain p-4"
                    width={225}
                    height={225}
                  />
                  <div class="p-4 text-center product-card-content">
                    <h4 class="font-medium text-signal-dark mb-4 product-title">{sign.name}</h4>
                    <a
                      href={sign.url}
                      class="block w-full bg-black text-signal-green border border-signal-green font-medium py-2 px-4 rounded-md hover:bg-signal-green hover:text-black transition-all text-center"
                    >
                      {productButtonText}
                    </a>
                  </div>
                </div>
              ))}
            </div>
          </section>
        </div>

        {/* Editorial Policy Section */}
        <section class="bg-black text-white rounded-xl p-8 my-12" aria-labelledby="editorial-policy-heading">
          <h3 id="editorial-policy-heading" class="text-2xl font-bold mb-4">{layoutContent.editorialPolicyContent.title}</h3>
          <p class="text-gray-300 mb-6">
            {layoutContent.editorialPolicyContent.description}
          </p>
          <a
            href={layoutContent.editorialPolicyContent.ctaLink}
            class="inline-block bg-signal-green text-black font-semibold px-6 py-3 rounded-lg hover:bg-[#a5d429] transition-colors"
          >
            {layoutContent.editorialPolicyContent.ctaText}
          </a>
        </section>

        {/* Disclaimer Section */}
        <aside class="bg-red-50 border border-red-100 rounded-xl p-6 mt-6">
          <p class="text-red-800 text-sm">
            {layoutContent.disclaimerContent.text}
          </p>
        </aside>

        {/* Related Articles Section */}
        {relatedArticlesForPage.articles && relatedArticlesForPage.articles.length > 0 && (
           <section class="border-t border-gray-200 pt-12 mt-12" aria-labelledby="related-articles-heading">
            <h2 id="related-articles-heading" class="text-2xl font-bold mb-8">{relatedArticlesForPage.title}</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
              {relatedArticlesForPage.articles.map(relatedArticle => (
                <article class="bg-white rounded-xl shadow-sm p-6 border border-gray-100">
                  <h3 class="font-semibold text-lg mb-2">
                    <a href={relatedArticle.url} class="text-signal-dark hover:text-signal-green transition-colors">
                      {relatedArticle.title}
                    </a>
                  </h3>
                  <p class="text-signal-gray text-sm">
                    {formatDate(relatedArticle.date, layoutContent.relatedDateLocale, layoutContent.relatedDateFormatOptions)}
                  </p>
                </article>
              ))}
            </div>
          </section>
        )}
      </article>

      <!-- Right Sidebar -->
      <aside class="lg:w-1/5">
        <div class="sticky top-24 space-y-6">
          <!-- Need Help Box -->
          <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-100">
            <h3 class="text-xl font-semibold text-signal-dark mb-3">{layoutContent.helpBoxContent.title}</h3>
            <p class="text-signal-gray mb-4">
              {layoutContent.helpBoxContent.description}
            </p>
            <a
              href={layoutContent.helpBoxContent.ctaLink}
              class="block bg-black text-signal-green border border-signal-green text-center font-medium py-3 px-4 rounded-lg hover:bg-signal-green hover:text-black transition-all"
            >
              {layoutContent.helpBoxContent.ctaText}
            </a>
          </div>
        </div>
      </aside>
    </div>
  </div>
</BaseLayout>

<style>
  .toc-link.active {
    color: var(--signal-green);
    background-color: #f0f9ff;
    font-weight: 600;
  }

  .toc-link.active:where([class*="border-l-4"]) {
    border-left-color: var(--signal-green);
  }
  .toc-link.active:where([class*="border-l-2"]) {
    border-left-color: var(--signal-green);
  }


  /* Custom styles for banners */
  :global(.fear-banner) {
    @apply bg-red-50 border border-red-100 rounded-xl p-6 my-8 flex items-center;
  }

  :global(.fear-banner::before) {
    content: "‚ö†Ô∏è";
    @apply text-2xl mr-4;
  }

  :global(.helpful-banner) {
    @apply bg-green-50 border border-green-100 rounded-xl p-6 my-8 flex items-center;
  }

  :global(.helpful-banner::before) {
    content: "üí°";
    @apply text-2xl mr-4;
  }

  /* FAQ section styles */
  :global(.faq-section) { /* This class is on the <section id={common.ARTICLE_H2_5_ID}> */
    @apply bg-gray-50 rounded-xl p-6 my-8;
  }

  :global(.faq-section h2) { /* This targets the <h2 id="faq-section-title-for-aria"> */
    @apply text-2xl font-bold mb-6;
  }

  :global(.faq-item) {
    @apply mb-4;
  }

  :global(.faq-question) {
    @apply font-semibold text-lg mb-2;
  }

  :global(.faq-answer) {
    @apply text-signal-gray;
  }

  /* Product grid styles */
  :global(.product-grid) {
    @apply grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 my-8;
  }

  :global(.product-card) {
    @apply bg-white rounded-lg shadow-md overflow-hidden border border-gray-200;
  }

  :global(.product-card img) {
    @apply w-full h-48 object-contain p-4;
  }

  :global(.product-card-content) {
    @apply p-4;
  }

  :global(.product-title) {
    @apply font-medium text-lg mb-4;
  }

  :global(.product-button) {
    @apply inline-block w-full bg-black text-signal-green border border-signal-green font-medium py-2 px-4 rounded-md hover:bg-signal-green hover:text-black transition-all text-center;
  }

  /* Basic Signs Grid */
  :global(.basic-signs-grid) {
    @apply grid grid-cols-1 md:grid-cols-3 gap-6 my-8;
  }

  :global(.basic-signs-grid .product-card) {
    @apply bg-white rounded-lg shadow-md overflow-hidden border border-gray-200;
  }

  :global(.basic-signs-grid a) {
    @apply block w-full bg-black text-signal-green border border-signal-green font-medium py-2 px-4 rounded-md hover:bg-signal-green hover:text-black transition-all text-center;
  }

  /* Flag icon styles */
  .flag-icon {
    width: 1.5em;
    height: 1em;
    object-fit: cover;
  }

  svg {
    width: 100%;
    height: 100%;
  }

  /* FAQ accordion styles */
  details > summary {
    list-style: none;
  }
  details > summary::-webkit-details-marker {
    display: none;
  }

  /* Specific style for FAQ chevron to override global SVG styles */
  .faq-chevron {
    width: 1.25rem !important; /* 20px */
    height: 1.25rem !important; /* 20px */
    flex-shrink: 0;
  }
</style>

<script>
  // Highlight TOC items when scrolling to section
  document.addEventListener('DOMContentLoaded', () => {
    const headings = Array.from(document.querySelectorAll('h2[id], h3[id], h4[id]'));
    const tocLinks = Array.from(document.querySelectorAll('.toc-link'));

    if (headings.length > 0 && tocLinks.length > 0) {
      const observerOptions = {
        rootMargin: '-100px 0px -60% 0px',
        threshold: 0
      };

      const headingObserver = new IntersectionObserver(entries => {
        entries.forEach(entry => {
          const id = entry.target.getAttribute('id');
          const tocLink = document.querySelector(`.toc-link[href="#${id}"]`);

          if (tocLink) {
            if (entry.isIntersecting && entry.intersectionRatio > 0) {
              tocLinks.forEach(link => link.classList.remove('active'));
              tocLink.classList.add('active');
            }
          }
        });
      }, observerOptions);

      headings.forEach(heading => {
        if (heading.id) {
            headingObserver.observe(heading);
        }
      });
    }
  });
</script>