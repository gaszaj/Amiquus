---
import HomepageLayout from '../layouts/HomepageLayout.astro';
import homeData from '../data/home.json';
import wwwData from '../data/www.json';
import commonData from '../data/common.json';

// Get the first (and only) object from each JSON array
const home = homeData[0];
const www = wwwData[0];
const common = commonData[0];

// Helper function for absolute URLs
const getAbsoluteUrl = (path) => {
  return new URL(path, Astro.url.origin).toString();
};

// --- Data for the Homepage ---

// Hero section data
const heroData = {
  title: home.HOME_H1,
  subtitle: home.HOME_SUBTITLE,
  ogImage: home.HOME_OG_IMAGE_PATH,
  ctaText: home.HOME_HERO_BUTTON,
  ctaLink: "#best-sellers",
  features: [
    home.PAGE_SOCIAL_SHARING_FEATURE_1,
    home.PAGE_SOCIAL_SHARING_FEATURE_2,
    home.PAGE_SOCIAL_SHARING_FEATURE_3
  ],
  socialProof: {
    text: home.HOME_HERO_SOCIAL_PROOF,
    rating: 5,
    userPhotos: [
      '/socialproof/sp6.webp',
      '/socialproof/sp10.webp',
      '/socialproof/sp13.webp',
      '/socialproof/sp14.webp',
      '/socialproof/sp20.webp'
    ]
  }
};

// Marquee items data
const marqueeItems = [
  { 
    url: home.HOME_BESTSELLER_NAME_1, 
    image: home.HOME_BESTSELLER_IMAGE_PATH_1,
    alt: home.HOME_BESTSELLER_NAME_1
  },
  { 
    url: home.HOME_BESTSELLER_PATH_2, 
    image: home.HOME_BESTSELLER_IMAGE_PATH_2, 
    alt: home.HOME_BESTSELLER_NAME_2
  },
  { 
    url: home.HOME_BESTSELLER_PATH_3, 
    image: home.HOME_BESTSELLER_IMAGE_PATH_3, 
    alt: home.HOME_BESTSELLER_NAME_3
  },
  { 
    url: home.HOME_BESTSELLER_PATH_4, 
    image: home.HOME_BESTSELLER_IMAGE_PATH_4, 
    alt: home.HOME_BESTSELLER_NAME_4
  },
  { 
    url: home.HOME_BESTSELLER_PATH_5, 
    image: home.HOME_BESTSELLER_IMAGE_PATH_5, 
    alt: home.HOME_BESTSELLER_NAME_5
  }
];

// Bestsellers section data
const bestsellersSection = {
  title: home.HOME_H2_1,
  productCtaText: home.HOME_HERO_BUTTON,
  products: [
    {
      title: home.HOME_BESTSELLER_NAME_1,
      image: home.HOME_BESTSELLER_IMAGE_PATH_1,
      url: home.HOME_BESTSELLER_PATH_1
    },
    {
      title: home.HOME_BESTSELLER_NAME_2,
      image: home.HOME_BESTSELLER_IMAGE_PATH_2,
      url: home.HOME_BESTSELLER_PATH_2
    },
    {
      title: home.HOME_BESTSELLER_NAME_3,
      image: home.HOME_BESTSELLER_IMAGE_PATH_3,
      url: home.HOME_BESTSELLER_PATH_3
    },
    {
      title: home.HOME_BESTSELLER_NAME_4,
      image: home.HOME_BESTSELLER_IMAGE_PATH_4,
      url: home.HOME_BESTSELLER_PATH_4
    },
    {
      title: home.HOME_BESTSELLER_NAME_5,
      image: home.HOME_BESTSELLER_IMAGE_PATH_5,
      url: home.HOME_BESTSELLER_PATH_5
    },
    {
      title: home.HOME_BESTSELLER_NAME_6,
      image: home.HOME_BESTSELLER_IMAGE_PATH_6,
      url: home.HOME_BESTSELLER_PATH_6
    },
    {
      title: home.HOME_BESTSELLER_NAME_7,
      image: home.HOME_BESTSELLER_IMAGE_PATH_7,
      url: home.HOME_BESTSELLER_PATH_7
    },
    {
      title: home.HOME_BESTSELLER_NAME_8,
      image: home.HOME_BESTSELLER_IMAGE_PATH_8,
      url: home.HOME_BESTSELLER_PATH_8
    },
    {
      title: home.HOME_BESTSELLER_NAME_9,
      image: home.HOME_BESTSELLER_IMAGE_PATH_9,
      url: home.HOME_BESTSELLER_PATH_9
    }
  ]
};

// Features section data
const featuresSection = {
  title: home.HOME_H2_2,
  items: [
    {
      icon: "âš¡",
      title: home.HOME_STRING_14,
      description: home.HOME_STRING_17
    },
    {
      icon: "ðŸ”„",
      title: home.HOME_STRING_15,
      description: home.HOME_STRING_18
    },
    {
      icon: "ðŸ“¦",
      title: home.HOME_STRING_16,
      description: home.HOME_STRING_19
    }
  ]
};

// Institutions section data
const institutionsSection = {
  title: home.HOME_H2_4,
  items: [
    home.INSTITUTION_1,
    home.INSTITUTION_2,
    home.INSTITUTION_3,
    home.INSTITUTION_4,
    home.INSTITUTION_5,
    home.INSTITUTION_6
  ]
};

// FAQ section data
const faqSection = {
  title: home.HOME_H2_5,
  items: [
    {
      question: home.HOME_Q1,
      answer: home.HOME_A1
    },
    {
      question: home.HOME_Q2,
      answer: home.HOME_A2
    },
    {
      question: home.HOME_Q3,
      answer: home.HOME_A3
    },
    {
      question: home.HOME_Q4,
      answer: home.HOME_A4
    },
    {
      question: home.HOME_Q5,
      answer: home.HOME_A5
    },
    {
      question: home.HOME_Q6,
      answer: home.HOME_A6
    },
    {
      question: home.HOME_Q7,
      answer: home.HOME_A7
    },
    {
      question: home.HOME_Q8,
      answer: home.HOME_A8
    },
    {
      question: home.HOME_Q9,
      answer: home.HOME_A9
    },
    {
      question: home.HOME_Q10,
      answer: home.HOME_A10
    },
    {
      question: home.HOME_Q11,
      answer: home.HOME_A11
    },
    {
      question: home.HOME_Q12,
      answer: home.HOME_A12
    },
    {
      question: home.HOME_Q13,
      answer: home.HOME_A13
    },
    {
      question: home.HOME_Q14,
      answer: home.HOME_A14
    },
    {
      question: home.HOME_Q15,
      answer: home.HOME_A15
    }
  ]
};

// Contact section data
const contactSection = {
  title: home.HOME_H2_6,
  subtitle: home.HOME_CONTACT_SUBTITLE,
  formLabels: {
    fullName: common.M_FULL_NAME,
    fullNamePlaceholder: common.M_FULLNAME_PLACEHOLDER,
    email: common.M_EMAIL,
    emailPlaceholder: common.M_EMAIL_PLACEHOLDER,
    message: common.M_MESSAGE,
    messagePlaceholder: common.M_PARTNERSHIP_MESSAGE_PLACEHOLDER,
    terms: common.M_TERMS_REQUIRED,
    submitButton: common.M_SEND_BUTTON
  }
};

// Form alert messages for client-side script
const formAlertMessages = {
  invalidEmail: common.M_EMAIL_INVALID,
  termsNotAccepted: common.M_TERMS_REQUIRED,
  submissionSuccess: common.M_CONFIRMATION_TEXT,
  submissionError: common.M_FORM_ERROR
};

// --- Schema Definition ---
const currentDate = new Date();
const formattedDate = currentDate.toISOString().split('T')[0];
const formattedTime = currentDate.toTimeString().split(' ')[0];

// WebPage and Article Schema
const webpageSchema = {
  "@context": "https://schema.org",
  "@type": "WebPage",
  "name": home.HOME_H1,
  "url": Astro.url.href,
  "description": home.HOME_META_SEO,
  "inLanguage": home.PAGE_LOCALE,
  "breadcrumb": {
    "@type": "BreadcrumbList",
    "itemListElement": [
      {
        "@type": "ListItem",
        "position": 1,
        "name": home.M_HOME_NAME,
        "item": Astro.url.href
      }
    ]
  },
  "mainEntity": {
    "@type": "Article",
    "headline": home.HOME_H1,
    "description": home.HOME_META_SEO,
    "image": getAbsoluteUrl(home.HOME_OG_IMAGE_PATH),
    "author": {
      "@type": "Organization",
      "name": www.PAGE_ORGANISATION_FULL_NAME
    },
    "datePublished": `${home.DATE_PUBLISHED}T${home.HOUR_PUBLISHED}+02:00`,
    "dateModified": `${home.DATE_UPDATED}T${home.HOUR_UPDATED}+02:00`,
    "inLanguage": home.PAGE_LOCALE
  }
};

// FAQ Schema
const faqSchema = {
  "@context": "https://schema.org",
  "@type": "FAQPage",
  "mainEntity": faqSection.items.map(item => ({
    "@type": "Question",
    "name": item.question,
    "acceptedAnswer": {
      "@type": "Answer",
      "text": item.answer
    }
  }))
};

// Organization Schema with dynamic links
const organizationSchema = {
  "@context": "https://schema.org",
  "@type": "Organization",
  "name": www.PAGE_ORGANISATION_FULL_NAME,
  "url": getAbsoluteUrl('/'),
  "foundingDate": www.PAGE_FOUNDING_DATE,
  "logo": getAbsoluteUrl(www.PAGE_LOGO_IMAGE_PATH_1),
  "keywords": [
    www.PAGE_ORGANISATION_FULL_NAME,
    www.M_COUNTRY_NATIVE,
    www.PAGE_KEYWORD_1,
    www.PAGE_KEYWORD_2,
    www.PAGE_KEYWORD_3,
    www.PAGE_KEYWORD_4,
    www.PAGE_KEYWORD_5,
    www.PAGE_KEYWORD_6
  ],
  "description": www.PAGE_DESCRIPTION,
  "numberOfEmployees": {
    "@type": "QuantitativeValue",
    "minValue": "1",
    "maxValue": "9"
  },
  "slogan": www.PAGE_SLOGAN,
  "contactPoint": {
    "@type": "ContactPoint",
    "email": www.PAGE_INFO_EMAIL,
    "contactType": common.M_CUSTOMER_SUPPORT
  },
  "sameAs": [
    www.PAGE_INSTAGRAM_URL,
    www.PAGE_FACEBOOK_URL,
    www.PAGE_TWITTER_URL,
    www.PAGE_LINKEDIN_URL,
    www.PAGE_YOUTUBE_URL,
    www.PAGE_PINTEREST_URL,
    www.PAGE_BLUESKY_URL
  ],
  "areaServed": {
    "@type": "Country",
    "name": www.M_COUNTRY,
    "identifier": www.M_COUNTRY_CODE
  },
  "potentialAction": [
    {
      "@type": "ViewAction",
      "name": www.PAGE_MASTER_SITEMAP_INSTRUCTIONS,
      "target": getAbsoluteUrl('/sitemap.xml')
    },
    {
      "@type": "ViewAction",
      "name": www.PAGE_LOCAL_SITEMAP_INSTRUCTIONS,
      "target": getAbsoluteUrl('/sitemap-sl-SI.xml')
    },
    {
      "@type": "ViewAction",
      "name": www.PAGE_LLM_INSTRUCTIONS,
      "target": getAbsoluteUrl('/llms.txt'),
      "description": www.PAGE_LLM_INSTRUCTIONS_DESCRIPTION
    }
  ],
  "mainEntityOfPage": [
    {
      "@type": "WebPage",
      "@id": getAbsoluteUrl('/sitemap.xml'),
      "name": www.PAGE_MASTER_SITEMAP_INSTRUCTIONS,
      "description": www.PAGE_MASTER_SITEMAP_INSTRUCTIONS_DESCRIPTION
    },
    {
      "@type": "WebPage",
      "@id": getAbsoluteUrl('/sitemap-sl-SI.xml'),
      "name": www.PAGE_LOCAL_SITEMAP_INSTRUCTIONS,
      "description": www.PAGE_LOCAL_SITEMAP_INSTRUCTIONS_DESCRIPTION
    },
    {
      "@type": "WebPage",
      "@id": getAbsoluteUrl('/llms.txt'),
      "name": www.PAGE_LLM_INSTRUCTIONS,
      "description": www.PAGE_LLM_INSTRUCTIONS_DESCRIPTION
    }
  ]
};

// Combine all schemas
const schema = [webpageSchema, faqSchema, organizationSchema];
---

<HomepageLayout 
  title={home.HOME_H1}
  description={home.HOME_META_SEO}
  ogImage={home.HOME_OG_IMAGE_PATH}
  heroData={heroData}
  marqueeItems={marqueeItems}
  bestsellersSection={bestsellersSection}
  featuresSection={featuresSection}
  institutionsSection={institutionsSection}
  faqSection={faqSection}
  contactSection={contactSection}
  formAlerts={formAlertMessages}
  schema={schema}
/>