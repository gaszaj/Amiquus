---
import AuthorLayout from '../layouts/AuthorLayout.astro';
import { SI, GB, DE, HR, RS } from 'country-flag-icons/string/3x2';
import authorData from '../data/author.json';
import wwwData from '../data/www.json';
import commonData from '../data/common.json';

// Add type definition for author data
interface AuthorData {
  AUTHOR_DATE_PUBLISHED: string;
  AUTHOR_HOUR_PUBLISHED: string;
  AUTHOR_DATE_UPDATED: string;
  AUTHOR_HOUR_UPDATED: string;
  WWW_AUTHOR: string;
  WWW_AUTHOR_ASCII: string;
  WWW_AUTHOR_SLUG: string;
  WWW_AUTHOR_NUMBER: string;
  AUTHOR_FULL_SLUG: string;
  AUTHOR_META_SEO: string;
  PAGE_LOCALE: string;
  AUTHOR_OG_IMAGE_PATH: string;
  AUTHOR_PROFILE_IMAGE_PATH: string;
  AUTHOR_IMAGE_NAME_ASCII: string;
  WWW_AUTHOR_BIO: string;
  WWW_AUTHOR_LINKEDIN: string;
  WWW_AUTHOR_X: string;
  WWW_AUTHOR_WEBSITE: string;
  WWW_AUTHOR_INSTAGRAM: string;
  WWW_AUTHOR_YOUTUBE: string;
  WWW_AUTHOR_QUORA_OR_TIKTOK: string;
  WWW_AUTHOR_EMAIL: string;
  WWW_AUTHOR_OCCUPATION: string;
  AUTHOR_WORKS_FOR: string;
  M_HOME_NAME: string;
  EEAT_NAME_20: string;
  EEAT_URL_20: string;
  WWW_AUTHOR_NATIONALITY: string;
  WWW_AUTHOR_LANGUAGE1: string;
  WWW_AUTHOR_LANGUAGE2: string;
  WWW_AUTHOR_LANGUAGE3: string;
  WWW_AUTHOR_LANGUAGE4: string;
  WWW_AUTHOR_LANGUAGE5: string;
  M_COUNTRY: string;
  M_COUNTRY_CODE: string;
  EEAT_SLUG_13: string;
}

const author = authorData[0] as AuthorData;
const www = wwwData[0];
const common = commonData[0];

// Helper function to create absolute URLs
const getAbsoluteUrl = (path) => {
  return new URL(path, Astro.url.origin).toString();
};

// --- Author's Core Data ---
const authorProfileData = {
  name: author.WWW_AUTHOR,
  description: author.WWW_AUTHOR_BIO,
  image: getAbsoluteUrl(`/authors/${author.AUTHOR_IMAGE_NAME_ASCII}`),
  socialLinks: {
    linkedin: author.WWW_AUTHOR_LINKEDIN,
    twitter: author.WWW_AUTHOR_X,
    website: author.WWW_AUTHOR_WEBSITE,
    instagram: author.WWW_AUTHOR_INSTAGRAM,
    youtube: author.WWW_AUTHOR_YOUTUBE,
    quora: author.WWW_AUTHOR_QUORA_OR_TIKTOK,
    email: author.WWW_AUTHOR_EMAIL
  },
  jobTitle: author.WWW_AUTHOR_OCCUPATION,
  company: author.AUTHOR_WORKS_FOR,
};

// --- Data for Layout Sections & UI Text ---
const languagesData = [
  { name: "Slovenian", flag: SI },
  { name: "English", flag: GB },
  { name: "German", flag: DE },
  { name: "Croatian", flag: HR },
  { name: "Serbian", flag: RS }
];

// --- Data for Layout Sections & UI Text ---
const layoutStringsData = {
  // Using author data for personalized strings
  baseLayoutDescriptionPrefix: common.AUTHOR_TITLE_EXTENSION_EXTENDED,
  authorImageAltText: `${author.WWW_AUTHOR} â€” ${author.EEAT_NAME_20} | ${www.PAGE_ORGANISATION_FULL_NAME}`,
  
  // Using common data for social media labels
  socialLinkLabelLinkedIn: common.AUTHOR_LINKEDIN_LABEL,
  socialLinkLabelTwitter: author.WWW_AUTHOR_X.includes('facebook') ? common.AUTHOR_FACEBOOK_LABEL : common.AUTHOR_TWITTER_LABEL,
  socialLinkLabelWebsite: common.AUTHOR_WEBSITE_LABEL,
  socialLinkLabelEmail: www.M_EMAIL,
  jobTitleAtCompanySeparator: " â€” ",
  
  // Using common data for section titles and icons
  languagesSectionTitle: common.AUTHOR_LANGUAGE_LABEL,
  languagesSectionIcon: "ðŸŒ",
  
  // Using author data for footer links
  footerLinkAllAuthorsText: common.AUTHOR_OTHER_AUTHORS,
  footerLinkAllAuthorsUrl: getAbsoluteUrl(`/${author.EEAT_URL_20}`),
  footerLinkEditorialPolicyText: common.AUTHOR_READ_MORE,
  footerLinkEditorialPolicyUrl: getAbsoluteUrl(`/${author.EEAT_SLUG_13}`),
};

// --- Schema Definition ---
// WebPage and Article Schema
const webpageSchema = {
  "@context": "https://schema.org",
  "@type": "WebPage",
  "name": author.WWW_AUTHOR,
  "url": getAbsoluteUrl(author.AUTHOR_FULL_SLUG),
  "description": author.AUTHOR_META_SEO,
  "inLanguage": author.PAGE_LOCALE,
  "breadcrumb": {
    "@type": "BreadcrumbList",
    "itemListElement": [
      {
        "@type": "ListItem",
        "position": 1,
        "name": author.M_HOME_NAME,
        "item": Astro.url.origin
      },
      {
        "@type": "ListItem",
        "position": 2,
        "name": author.EEAT_NAME_20,
        "item": getAbsoluteUrl(`/${author.EEAT_URL_20}`)
      },
      {
        "@type": "ListItem",
        "position": 3,
        "name": author.WWW_AUTHOR,
        "item": getAbsoluteUrl(`/${author.EEAT_URL_20}/${author.WWW_AUTHOR_NUMBER}-${author.WWW_AUTHOR_SLUG}`)
      }
    ]
  },
  "mainEntity": {
    "@type": "Article",
    "headline": author.WWW_AUTHOR,
    "description": author.AUTHOR_META_SEO,
    "image": getAbsoluteUrl(author.AUTHOR_OG_IMAGE_PATH),
    "author": {
      "@type": "Organization",
      "name": www.PAGE_ORGANISATION_URL_NAME
    },
    "datePublished": `${author.AUTHOR_DATE_PUBLISHED}T${author.AUTHOR_HOUR_PUBLISHED}+02:00`,
    "dateModified": `${author.AUTHOR_DATE_UPDATED}T${author.AUTHOR_HOUR_UPDATED}+02:00`,
    "inLanguage": author.PAGE_LOCALE
  }
};

// Person Schema
const personSchema = {
  "@context": "https://schema.org",
  "@type": "Person",
  "name": author.WWW_AUTHOR,
  "url": getAbsoluteUrl(author.AUTHOR_FULL_SLUG),
  "description": `${author.WWW_AUTHOR} â€” ${author.EEAT_NAME_20}: ${www.PAGE_ORGANISATION_FULL_NAME}. Preberite veÄ o tej osebi in kakÅ¡na je njegova vloga v podjetju.`,
  "sameAs": [
    author.WWW_AUTHOR_WEBSITE,
    author.WWW_AUTHOR_LINKEDIN,
    author.WWW_AUTHOR_X,
    author.WWW_AUTHOR_INSTAGRAM,
    author.WWW_AUTHOR_YOUTUBE,
    author.WWW_AUTHOR_QUORA_OR_TIKTOK,
    `mailto:${author.WWW_AUTHOR_EMAIL}`
  ],
  "email": author.WWW_AUTHOR_EMAIL,
  "jobTitle": author.WWW_AUTHOR_OCCUPATION,
  "worksFor": {
    "@type": "Organization",
    "name": www.PAGE_ORGANISATION_URL_NAME,
    "url": getAbsoluteUrl(www.PAGE_LOGO_IMAGE_PATH_1)
  },
  "image": getAbsoluteUrl(author.AUTHOR_PROFILE_IMAGE_PATH),
  "nationality": {
    "@type": "Country",
    "name": author.WWW_AUTHOR_NATIONALITY
  },
  "knowsLanguage": [
    { "@type": "Language", "name": author.WWW_AUTHOR_LANGUAGE1 },
    { "@type": "Language", "name": author.WWW_AUTHOR_LANGUAGE2 },
    { "@type": "Language", "name": author.WWW_AUTHOR_LANGUAGE3 },
    { "@type": "Language", "name": author.WWW_AUTHOR_LANGUAGE4 },
    { "@type": "Language", "name": author.WWW_AUTHOR_LANGUAGE5 }
  ].filter(lang => lang.name.trim()),
  "disambiguatingDescription": author.WWW_AUTHOR_BIO
};

// Organization Schema
const organizationSchema = {
  "@context": "https://schema.org",
  "@type": "Organization",
  "name": www.PAGE_ORGANISATION_FULL_NAME,
  "foundingDate": www.PAGE_FOUNDING_DATE,
  "logo": getAbsoluteUrl(www.PAGE_LOGO_IMAGE_PATH_1),
  "keywords": [
    www.PAGE_ORGANISATION_FULL_NAME,
    author.WWW_AUTHOR_ASCII,
    author.WWW_AUTHOR
  ],
  "numberOfEmployees": {
    "@type": "QuantitativeValue",
    "minValue": "1",
    "maxValue": "9"
  },
  "slogan": www.PAGE_SLOGAN,
  "contactPoint": {
    "@type": "ContactPoint",
    "email": www.PAGE_INFO_EMAIL,
    "contactType": common.M_CUSTOMER_SUPPORT
  },
  "sameAs": [
    www.PAGE_INSTAGRAM_URL,
    www.PAGE_FACEBOOK_URL,
    www.PAGE_TWITTER_URL,
    www.PAGE_LINKEDIN_URL,
    www.PAGE_YOUTUBE_URL,
    www.PAGE_PINTEREST_URL,
    www.PAGE_BLUESKY_URL
  ],
  "areaServed": {
    "@type": "Country",
    "name": author.M_COUNTRY,
    "identifier": author.M_COUNTRY_CODE
  }
};

// Combine all schemas
const schema = [webpageSchema, personSchema, organizationSchema];
---

<AuthorLayout
  name={authorProfileData.name}
  description={authorProfileData.description}
  image={authorProfileData.image}
  socialLinks={authorProfileData.socialLinks}
  jobTitle={authorProfileData.jobTitle}
  company={authorProfileData.company}
  languages={languagesData}
  layoutStrings={layoutStringsData}
  schema={schema}
/>