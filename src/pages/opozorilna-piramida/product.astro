---
import ProductLayout from '../../layouts/ProductLayout.astro';
import type { RelatedProductInfo, FaqItemData, ProductLayoutStrings } from '../../layouts/ProductLayout.astro';
import productData from '../../data/product.json';
import wwwData from '../../data/www.json';
import commonData from '../../data/common.json';

// Get the first (and only) object from each JSON array
const product = productData[0];
const www = wwwData[0];
const common = commonData[0];

// Helper function for absolute URLs
const getAbsoluteUrl = (path) => {
  return new URL(path, Astro.url.origin).toString();
};

const productCoreData = {
  title: product.PRODUCT_H1,
  subtitle: product.PRODUCT_SUBTITLE,
  description: product.PRODUCT_META_SEO,
  price: product.M_PRODUCT_PRICE,
  ogImage: product.PRODUCT_OG_IMAGE_PATH,
  image: product.PRODUCT_IMAGE_PATH,
  specifications: {
    dimensions: common.PRODUCT_SPECIFICATIONS_VALUE_1,
    material: common.PRODUCT_SPECIFICATIONS_VALUE_2,
    weight: common.PRODUCT_SPECIFICATIONS_VALUE_3,
    visibility: common.PRODUCT_SPECIFICATIONS_VALUE_4,
    windResistance: common.PRODUCT_SPECIFICATIONS_VALUE_5,
    setupTime: common.PRODUCT_SPECIFICATIONS_VALUE_6
  },
  category: product.PRODUCT_CATEGORY_1_SLUG,
  productId: product.PRODUCT_ID
};

const productFaqItems: FaqItemData[] = [
  { question: product.PRODUCT_Q1, answer: product.PRODUCT_A1 },
  { question: product.PRODUCT_Q2, answer: product.PRODUCT_A2 },
  { question: product.PRODUCT_Q3, answer: product.PRODUCT_A3 },
  { question: product.PRODUCT_Q4, answer: product.PRODUCT_A4 },
  { question: product.PRODUCT_Q5, answer: product.PRODUCT_A5 },
  { question: product.PRODUCT_Q6, answer: product.PRODUCT_A6 },
  { question: product.PRODUCT_Q7, answer: product.PRODUCT_A7 },
  { question: product.PRODUCT_Q8, answer: product.PRODUCT_A8 },
  { question: product.PRODUCT_Q9, answer: product.PRODUCT_A9 },
  { question: product.PRODUCT_Q10, answer: product.PRODUCT_A10 },
  { question: product.PRODUCT_Q11, answer: product.PRODUCT_A11 },
  { question: product.PRODUCT_Q12, answer: product.PRODUCT_A12 },
  { question: product.PRODUCT_Q13, answer: product.PRODUCT_A13 }
];

const allAvailableProducts: RelatedProductInfo[] = [
  { id: product.PRODUCT_RELATEDP1, title: "Opozorilna piramida ČIŠČENJE BAZENOV", image: "/productimg/bigger-350/triopan-čiščenje-bazenov.webp", category: product.PRODUCT_CATEGORY_1_SLUG, url: "/si/opozorilna-piramida/ciscenje-bazenov" },
  { id: product.PRODUCT_RELATEDP2, title: "Opozorilna piramida OBVEZNA SMER LEVO", image: "/productimg/bigger-350/triopan-obvezna-smer-levo.webp", category: product.PRODUCT_CATEGORY_1_SLUG, url: "/si/opozorilna-piramida/obvezna-smer-levo" },
  { id: product.PRODUCT_RELATEDP3, title: "Opozorilna piramida ZOŽENJE Z LEVE", image: "/productimg/bigger-350/triopan-zoženje-z-leve.webp", category: product.PRODUCT_CATEGORY_1_SLUG, url: "/si/opozorilna-piramida/zoženje-z-leve" },
  { id: product.PRODUCT_RELATEDP4, title: "Opozorilna piramida PREPOVED USTAVLJANJA", image: "/productimg/bigger-350/triopan-prepoved-ustavljanja.webp", category: product.PRODUCT_CATEGORY_1_SLUG, url: "/si/opozorilna-piramida/prepoved-ustavljanja" },
  { id: product.PRODUCT_RELATEDP5, title: "Opozorilna piramida KOŠNJA TRAVE", image: "/productimg/bigger-350/triopan-košnja-trave.webp", category: product.PRODUCT_CATEGORY_1_SLUG, url: "/si/opozorilna-piramida/kosnja-trave" },
  { id: product.PRODUCT_RELATEDP6, title: "Opozorilna piramida KOLESARSKI IZPIT", image: "/productimg/bigger-350/triopan-kolesarski-izpit.webp", category: product.PRODUCT_CATEGORY_1_SLUG, url: "/si/opozorilna-piramida/kolesarski-izpit" }
];

const filteredRelatedProducts = allAvailableProducts
  .filter(product => product.id !== productCoreData.productId)
  .sort((a, b) => {
    if (a.category === productCoreData.category && b.category !== productCoreData.category) return -1;
    if (a.category !== productCoreData.category && b.category === productCoreData.category) return 1;
    return 0;
  })
  .slice(0, 3);

const ogImage = product.PRODUCT_OG_IMAGE_PATH;

const productQuantityOptions: number[] = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 12, 14, 16, 18, 20, 22, 24, 30];

const productPageLayoutStrings: ProductLayoutStrings = {
  techSpecTitle: common.PRODUCT_SPECIFICATIONS_TITLE,
  techSpecDimensionsLabel: common.PRODUCT_SPECIFICATIONS_LABEL_1,
  techSpecMaterialLabel: common.PRODUCT_SPECIFICATIONS_LABEL_2,
  techSpecWeightLabel: common.PRODUCT_SPECIFICATIONS_LABEL_3,
  techSpecVisibilityLabel: common.PRODUCT_SPECIFICATIONS_LABEL_4,
  techSpecWindResistanceLabel: common.PRODUCT_SPECIFICATIONS_LABEL_5,
  techSpecSetupTimeLabel: common.PRODUCT_SPECIFICATIONS_LABEL_6,
  orderButtonText: common.PRODUCT_PAGE_ORDER_BUTTON_TEXT,
  orderFormTitle: common.PRODUCT_INQUIRY_LABEL,
  orderFormSubtitleBase: common.PRODUCT_PAGE_ORDER_FORM_SUBTITLE_BASE,
  orderFormNameLabel: common.PRODUCT_PAGE_ORDER_FORM_NAME_LABEL,
  orderFormNamePlaceholder: common.PRODUCT_PAGE_ORDER_FORM_NAME_PLACEHOLDER,
  orderFormSurnameLabel: common.PRODUCT_PAGE_ORDER_FORM_SURNAME_LABEL,
  orderFormSurnamePlaceholder: common.PRODUCT_PAGE_ORDER_FORM_SURNAME_PLACEHOLDER,
  orderFormCompanyLabel: common.PRODUCT_PAGE_ORDER_FORM_COMPANY_LABEL,
  orderFormCompanyPlaceholder: common.PRODUCT_PAGE_ORDER_FORM_COMPANY_PLACEHOLDER,
  orderFormVatIdLabel: common.PRODUCT_PAGE_ORDER_FORM_VAT_ID_LABEL,
  orderFormVatIdPlaceholder: common.PRODUCT_PAGE_ORDER_FORM_VAT_ID_PLACEHOLDER,
  orderFormStreetLabel: common.PRODUCT_PAGE_ORDER_FORM_STREET_LABEL,
  orderFormStreetPlaceholder: common.PRODUCT_PAGE_ORDER_FORM_STREET_PLACEHOLDER,
  orderFormCityLabel: common.PRODUCT_PAGE_ORDER_FORM_CITY_LABEL,
  orderFormCityPlaceholder: common.PRODUCT_PAGE_ORDER_FORM_CITY_PLACEHOLDER,
  orderFormZipLabel: common.PRODUCT_PAGE_ORDER_FORM_ZIP_LABEL,
  orderFormZipPlaceholder: common.PRODUCT_PAGE_ORDER_FORM_ZIP_PLACEHOLDER,
  orderFormEmailLabel: common.PRODUCT_PAGE_ORDER_FORM_EMAIL_LABEL,
  orderFormEmailPlaceholder: common.PRODUCT_PAGE_ORDER_FORM_EMAIL_PLACEHOLDER,
  orderFormPhoneLabel: common.PRODUCT_PAGE_ORDER_FORM_PHONE_LABEL,
  orderFormPhonePlaceholder: common.PRODUCT_PAGE_ORDER_FORM_PHONE_PLACEHOLDER,
  orderFormQuantityLabel: common.PRODUCT_PAGE_ORDER_FORM_QUANTITY_LABEL,
  orderFormQuantityDefaultOption: common.PRODUCT_PAGE_ORDER_FORM_QUANTITY_DEFAULT_OPTION,
  orderFormPaymentLabelBase: common.PRODUCT_PAGE_ORDER_FORM_PAYMENT_LABEL_BASE,
  orderFormPaymentCod: common.PRODUCT_PAGE_ORDER_FORM_PAYMENT_COD,
  orderFormPaymentPreInvoice: common.PRODUCT_PAGE_ORDER_FORM_PAYMENT_PRE_INVOICE,
  orderFormMessageLabel: common.PRODUCT_PAGE_ORDER_FORM_MESSAGE_LABEL,
  orderFormMessagePlaceholder: common.PRODUCT_PAGE_ORDER_FORM_MESSAGE_PLACEHOLDER,
  orderFormTermsLabel: common.PRODUCT_PAGE_ORDER_FORM_TERMS_LABEL,
  orderFormSubmitButtonText: common.PRODUCT_PAGE_ORDER_FORM_SUBMIT_BUTTON_TEXT,
  faqSectionTitle: common.PRODUCT_PAGE_FAQ_SECTION_TITLE,
  faqBackButtonText: common.PRODUCT_PAGE_FAQ_BACK_BUTTON_TEXT,
  relatedProductsTitle: common.PRODUCT_PAGE_RELATED_PRODUCTS_TITLE,
  relatedProductViewButtonText: common.PRODUCT_PAGE_RELATED_PRODUCT_VIEW_BUTTON_TEXT,
  customerSupportTitle: common.PRODUCT_PAGE_CUSTOMER_SUPPORT_SECTION_TITLE,
  customerSupportEmail: www.PAGE_INFO_EMAIL,
  
  validationNameRequired: common.PRODUCT_PAGE_VALIDATION_NAME_REQUIRED,
  validationSurnameRequired: common.PRODUCT_PAGE_VALIDATION_SURNAME_REQUIRED,
  validationStreetRequired: common.PRODUCT_PAGE_VALIDATION_STREET_REQUIRED,
  validationCityRequired: common.PRODUCT_PAGE_VALIDATION_CITY_REQUIRED,
  validationZipRequired: common.PRODUCT_PAGE_VALIDATION_ZIP_REQUIRED,
  validationEmailRequired: common.PRODUCT_PAGE_VALIDATION_EMAIL_REQUIRED,
  validationEmailInvalid: common.M_EMAIL_INVALID,
  validationPhoneRequired: common.PRODUCT_PAGE_VALIDATION_PHONE_REQUIRED,
  validationQuantityRequired: common.PRODUCT_PAGE_VALIDATION_QUANTITY_REQUIRED,
  validationPaymentRequired: common.PRODUCT_PAGE_VALIDATION_PAYMENT_REQUIRED,
  validationTermsRequired: common.PRODUCT_PAGE_VALIDATION_TERMS_REQUIRED,
  
  formSuccessMessage: common.M_CONFIRMATION_TEXT
};

// Product Schema
const productSchema = {
  "@context": "https://schema.org/",
  "@type": "Product",
  "name": product.PRODUCT_H1,
  "image": getAbsoluteUrl(product.PRODUCT_IMAGE_PATH),
  "mpn": product.PRODUCT_MPN,
  "category": product.PRODUCT_CATEGORY_1,
  "weight": {
    "@type": "QuantitativeValue",
    "value": common.PRODUCT_SPECIFICATIONS_VALUE_3.replace(/[^0-9.]/g, ''),
    "unitCode": "KGM"
  },
  "keywords": [
    product.PRODUCT_NAME,
    product.M_LANGUAGE_NATIVE,
    product.PRODUCT_KEYWORD_1,
    product.PRODUCT_KEYWORD_2,
    product.PRODUCT_KEYWORD_3,
    product.PRODUCT_KEYWORD_4,
    product.PRODUCT_KEYWORD_5,
    product.PRODUCT_KEYWORD_6,
    product.PRODUCT_KEYWORD_7
  ],
  "description": product.PRODUCT_META_SEO,
  "brand": {
    "@type": "Brand",
    "name": www.PAGE_ORGANISATION_URL_NAME
  },
  "review": {
    "@type": "Review",
    "reviewRating": {
      "@type": "Rating",
      "ratingValue": product.PRODUCT_RATING_VALUE,
      "bestRating": 5
    },
    "author": {
      "@type": "Person",
      "name": product.PRODUCT_AUTHOR
    }
  },
  "aggregateRating": {
    "@type": "AggregateRating",
    "ratingValue": product.PRODUCT_RATING_VALUE,
    "reviewCount": product.PRODUCT_REVIEW_COUNT
  },
  "offers": {
    "@type": "Offer",
    "url": Astro.url.href,
    "priceCurrency": product.M_CURRENCY_CODE,
    "price": product.M_PRODUCT_PRICE,
    "priceValidUntil": product.PRODUCT_EXPIRATION_DATE,
    "availability": "https://schema.org/InStock",
    "itemCondition": "https://schema.org/NewCondition"
  }
};

// FAQ Schema
const faqSchema = {
  "@context": "https://schema.org",
  "@type": "FAQPage",
  "mainEntity": productFaqItems.map(item => ({
    "@type": "Question",
    "name": item.question,
    "acceptedAnswer": {
      "@type": "Answer",
      "text": item.answer
    }
  }))
};

// Organization Schema
const organizationSchema = {
  "@context": "https://schema.org",
  "@type": "Organization",
  "name": www.PAGE_ORGANISATION_FULL_NAME,
  "url": getAbsoluteUrl('/'),
  "foundingDate": www.PAGE_FOUNDING_DATE,
  "logo": getAbsoluteUrl(www.PAGE_LOGO_IMAGE_PATH_1),
  "keywords": [
    www.PAGE_ORGANISATION_FULL_NAME,
    www.M_COUNTRY_NATIVE,
    www.PAGE_KEYWORD_1,
    www.PAGE_KEYWORD_2,
    www.PAGE_KEYWORD_3,
    www.PAGE_KEYWORD_4,
    www.PAGE_KEYWORD_5,
    www.PAGE_KEYWORD_6
  ],
  "description": www.PAGE_DESCRIPTION,
  "numberOfEmployees": {
    "@type": "QuantitativeValue",
    "minValue": "1",
    "maxValue": "9"
  },
  "slogan": www.PAGE_SLOGAN,
  "contactPoint": {
    "@type": "ContactPoint",
    "email": www.PAGE_INFO_EMAIL,
    "contactType": common.M_CUSTOMER_SUPPORT
  },
  "sameAs": [
    www.PAGE_INSTAGRAM_URL,
    www.PAGE_FACEBOOK_URL,
    www.PAGE_TWITTER_URL,
    www.PAGE_LINKEDIN_URL,
    www.PAGE_TIKTOK_URL,
    www.PAGE_YOUTUBE_URL,
    www.PAGE_PINTEREST_URL
  ],
  "areaServed": {
    "@type": "Country",
    "name": www.M_COUNTRY,
    "identifier": www.M_COUNTRY_CODE
  },
  "potentialAction": [
    {
      "@type": "ViewAction",
      "name": www.PAGE_MASTER_SITEMAP_INSTRUCTIONS,
      "target": getAbsoluteUrl('/sitemap.xml')
    },
    {
      "@type": "ViewAction",
      "name": www.PAGE_LOCAL_SITEMAP_INSTRUCTIONS,
      "target": getAbsoluteUrl('/sitemap-sl-SI.xml')
    },
    {
      "@type": "ViewAction",
      "name": www.PAGE_LLM_INSTRUCTIONS,
      "target": getAbsoluteUrl('/llms.txt'),
      "description": www.PAGE_LLM_INSTRUCTIONS_DESCRIPTION
    }
  ],
  "mainEntityOfPage": [
    {
      "@type": "WebPage",
      "@id": getAbsoluteUrl('/sitemap.xml'),
      "name": www.PAGE_MASTER_SITEMAP_INSTRUCTIONS,
      "description": www.PAGE_MASTER_SITEMAP_INSTRUCTIONS_DESCRIPTION
    },
    {
      "@type": "WebPage",
      "@id": getAbsoluteUrl('/sitemap-sl-SI.xml'),
      "name": www.PAGE_LOCAL_SITEMAP_INSTRUCTIONS,
      "description": www.PAGE_LOCAL_SITEMAP_INSTRUCTIONS_DESCRIPTION
    },
    {
      "@type": "WebPage",
      "@id": getAbsoluteUrl('/llms.txt'),
      "name": www.PAGE_LLM_INSTRUCTIONS,
      "description": www.PAGE_LLM_INSTRUCTIONS_DESCRIPTION
    }
  ]
};

// Combine all schemas
const combinedSchema = [productSchema, faqSchema, organizationSchema];
---

<ProductLayout
  title={productCoreData.title}
  subtitle={productCoreData.subtitle}
  description={productCoreData.description}
  price={productCoreData.price}
  ogImage={productCoreData.ogImage}
  image={productCoreData.image}
  specifications={productCoreData.specifications}
  relatedProducts={filteredRelatedProducts}
  quantityOptions={productQuantityOptions}
  faqItems={productFaqItems}
  layoutStrings={productPageLayoutStrings}
  schema={combinedSchema}
>
  <div class="product-description space-y-6">
    <div class="bg-signal-green/5 p-6 rounded-lg border-l-4 border-signal-green mb-8">
      <div class="flex items-center gap-4">
        <svg class="w-12 h-12 text-signal-green" viewBox="0 0 16 16">
          <g fill="#000">
            <path d="M12.5 16a3.5 3.5 0 1 0 0-7a3.5 3.5 0 0 0 0 7m1.679-4.493l-1.335 2.226a.75.75 0 0 1-1.174.144l-.774-.773a.5.5 0 0 1 .708-.708l.547.548l1.17-1.951a.5.5 0 1 1 .858.514M11 5a3 3 0 1 1-6 0a3 3 0 0 1 6 0M8 7a2 2 0 1 0 0-4a2 2 0 0 0 0 4"/>
            <path d="M8.256 14a4.5 4.5 0 0 1-.229-1.004H3c.001-.246.154-.986.832-1.664C4.484 10.68 5.711 10 8 10q.39 0 .74.025c.226-.341.496-.65.804-.918Q8.844 9.002 8 9c-5 0-6 3-6 4s1 1 1 1z"/>
          </g>
        </svg>
        <p class="text-xl font-semibold">{product.PRODUCT_PEER_PRESSURE_1}</p>
      </div>
    </div>

    <div class="bg-gray-50 p-6 rounded-lg">
      <h2 class="text-xl font-semibold mb-4">{product.PRODUCT_AUTHORITY_PROOF_H2}</h2>
      <ul class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <li class="flex items-center gap-4">
          <svg class="w-10 h-10 text-green-500 flex-shrink-0" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/></svg>
          <span class="text-lg">{product.PRODUCT_AUTHORITY_PROOF_1}</span>
        </li>
        <li class="flex items-center gap-4">
          <svg class="w-10 h-10 text-green-500 flex-shrink-0" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/></svg>
          <span class="text-lg">{product.PRODUCT_AUTHORITY_PROOF_2}</span>
        </li>
        <li class="flex items-center gap-4">
          <svg class="w-10 h-10 text-green-500 flex-shrink-0" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/></svg>
          <span class="text-lg">{product.PRODUCT_AUTHORITY_PROOF_3}</span>
        </li>
      </ul>
    </div>
    
    <div class="bg-yellow-50 p-6 rounded-lg">
      <div class="flex flex-col space-y-4">
        <div class="flex items-center gap-4">
          <svg class="w-12 h-12 text-yellow-700" viewBox="0 0 24 24"><path fill="currentColor" d="M12 2c5.523 0 10 4.477 10 10s-4.477 10-10 10S2 17.523 2 12S6.477 2 12 2m0 2a8 8 0 1 0 0 16a8 8 0 0 0 0-16m0 11a1 1 0 1 1 0 2a1 1 0 0 1 0-2m0-9a1 1 0 0 1 1 1v6a1 1 0 1 1-2 0V7a1 1 0 0 1 1-1"/></svg>
          <h3 class="text-xl font-semibold text-yellow-800">{product.PRODUCT_FEAR_TRIGGER_1}</h3>
        </div>
        <p class="text-yellow-700 ml-16">
          {product.PRODUCT_FEAR_TRIGGER_2}
        </p>
      </div>
    </div>

    <div class="space-y-4">
      <p>{product.PRODUCT_USE_CASES_COMPILED}</p>
      <ul class="list-disc pl-6 space-y-2">
        <li>{product.PRODUCT_USE_CASE_1}</li>
        <li>{product.PRODUCT_USE_CASE_2}</li>
        <li>{product.PRODUCT_USE_CASE_3}</li>
      </ul>
    </div>

    <div class="bg-signal-green/10 p-6 rounded-lg border-l-4 border-signal-green">
      <p class="text-xl font-semibold">{product.PRODUCT_PUSH_TRIGGER_1}</p>
    </div>
  </div>
</ProductLayout>