---
// Import JSON data
import commonData from '../data/common.json';
const common = commonData[0]; // Get the first (and only) object from commonData array

import manifestData from '../data/site.webmanifest.json';

import '@fontsource-variable/inter';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';

export interface Props {
  title: string;
  description?: string;
  image?: string;
  keywords?: string;
  locale?: string;
}

const {
  title,
  description = `${common.PAGE_ORGANISATION_FULL_NAME} - Premium safety signs and triopan warning systems manufactured in Slovenia and distributed across Europe.`,
  image = "/images/og-image.jpg",
  keywords = "safety signs, warning signs, triopan, road safety, construction safety, event safety",
  locale = "sl-SI" // Default locale
} = Astro.props;

// Helper to ensure icon paths are relative to the public directory root
const publicPath = (src: string) => `/${src.startsWith('/') ? src.substring(1) : src}`;
---

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/png" href="eusignal-favicon-32x32.png" />
    <meta name="generator" content={Astro.generator} />

    <!-- Primary Meta Tags -->
    <title>{title} | {common.PAGE_ORGANISATION_FULL_NAME}</title>
    <meta name="title" content={`${title} | ${common.PAGE_ORGANISATION_FULL_NAME}`} />
    <meta name="description" content={description} />
    <meta name="keywords" content={keywords} />

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content={Astro.url} />
    <meta property="og:title" content={`${title} | ${common.PAGE_ORGANISATION_FULL_NAME}`} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={new URL(image, Astro.url)} />
    <meta property="og:locale" content={locale} />

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:url" content={Astro.url} />
    <meta property="twitter:title" content={`${title} | ${common.PAGE_ORGANISATION_FULL_NAME}`} />
    <meta property="twitter:description" content={description} />
    <meta property="twitter:image" content={new URL(image, Astro.url)} />

    <!-- Mobile/Web App Metadata -->
    <meta name="application-name" content={common.PAGE_ORGANISATION_FULL_NAME} />
    <meta name="apple-mobile-web-app-title" content={common.PAGE_ORGANISATION_FULL_NAME} />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="format-detection" content="telephone=no" />
    {/* Theme color from the imported manifest data */}
    {manifestData.theme_color && <meta name="theme-color" content={manifestData.theme_color} />}

    <!-- Favicon and Icons from imported Manifest Data -->
    {manifestData.icons && manifestData.icons.map(icon => {
      const href = publicPath(icon.src);
      if (icon.src.includes('apple-touch-icon')) {
        return <link rel="apple-touch-icon" sizes={icon.sizes} href={href} type={icon.type} />;
      }
      return <link rel="icon" type={icon.type} sizes={icon.sizes} href={href} />;
    })}
    <link rel="manifest" href="/site.webmanifest" crossorigin="anonymous" />


    <!-- Preconnect -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap"
      rel="stylesheet"
    />

    <!-- Google Tag Manager -->
    {common.PAGE_GOOGLE_ANALYTICS_ID && (
      <>
        <script async src={`https://www.googletagmanager.com/gtag/js?id=${common.PAGE_GOOGLE_ANALYTICS_ID}`}></script>
        <script is:inline define:vars={{ gtagId: common.PAGE_GOOGLE_ANALYTICS_ID }}>
          window.dataLayer = window.dataLayer || [];
          function gtag() {
            dataLayer.push(arguments);
          }
          gtag('js', new Date());
          gtag('config', gtagId);
        </script>
      </>
    )}

    <!-- Microsoft Clarity -->
    {common.PAGE_MICROSOFT_CLARITY && (
      <script type="text/javascript" is:inline define:vars={{ clarityId: common.PAGE_MICROSOFT_CLARITY }}>
        (function (c, l, a, r, i, t, y) {
          c[a] =
            c[a] ||
            function () {
              (c[a].q = c[a].q || []).push(arguments);
            };
          t = l.createElement(r);
          t.async = 1;
          t.src = 'https://www.clarity.ms/tag/' + i; // i is clarityId here
          y = l.getElementsByTagName(r)[0];
          y.parentNode.insertBefore(t, y);
        })(window, document, 'clarity', 'script', clarityId);
      </script>
    )}

    <!-- Bing Webmasters Tools -->
    {common.PAGE_BING_VALIDATE && (
      <meta name="msvalidate.01" content={common.PAGE_BING_VALIDATE} />
    )}

    <!-- Yandex Webmasters Tools -->
    {common.PAGE_YANDEX_VALIDATE && (
      <meta name="yandex-verification" content={common.PAGE_YANDEX_VALIDATE} />
    )}
    
    <slot name="schema" />
  </head>
  <body class="min-h-screen bg-signal-light flex flex-col">
    <Header />
    <main class="flex-grow">
      <slot />
    </main>
    <Footer />

    <!-- Move to Top Button -->
    <button
      id="moveToTop"
      class="fixed bottom-[25px] right-[25px] w-10 h-10 bg-[#BCEF2F] rounded-lg shadow-lg flex items-center justify-center opacity-0 invisible transition-all duration-300 hover:bg-[#a5d429] focus:outline-none focus:ring-2 focus:ring-[#BCEF2F] focus:ring-opacity-50"
      aria-label="Move to top"
    >
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M12 19V5M5 12l7-7 7 7"/>
      </svg>
    </button>
  </body>
</html>

<style is:global>
  :root {
    --font-size-base: clamp(1rem, 0.34vw + 0.91rem, 1.19rem);
    --font-size-lg: clamp(1.2rem, 0.7vw + 1.2rem, 1.5rem); 
    --font-size-xl: clamp(2.44rem, 2.38vw + 1.85rem, 3.75rem);
    --line-height-body: 1.5;
    --line-height-heading: 1.2;
  }

  html {
    font-family: 'Inter Variable', system-ui, sans-serif;
    scroll-behavior: smooth;
  }

  body {
    font-size: var(--font-size-base);
    line-height: var(--line-height-body);
    color: #111827;
  }

  h1, h2, h3, h4, h5, h6 {
    line-height: var(--line-height-heading);
    font-weight: 700;
  }

  h1 {
    font-size: var(--font-size-xl);
    margin-top: 1.5rem;
    margin-bottom: 1rem;
  }

  h2 {
    font-size: var(--font-size-lg);
    margin-top: 1.5rem;
    margin-bottom: 0.75rem;
  }

  p {
    margin-bottom: 1rem;
  }

  .animate-on-scroll {
    opacity: 0;
    transform: translateY(20px);
    transition: opacity 0.6s ease-out, transform 0.6s ease-out;
  }

  .animate-on-scroll.visible {
    opacity: 1;
    transform: translateY(0);
  }
</style>

<script>
  // Animation observer for scroll animations
  document.addEventListener('DOMContentLoaded', () => {
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('visible');
        }
      });
    }, { threshold: 0.1 });

    document.querySelectorAll('.animate-on-scroll').forEach(element => {
      observer.observe(element);
    });

    // Move to Top Button functionality
    const moveToTopButton = document.getElementById('moveToTop');
    
    if (moveToTopButton) {
      // Show/hide button based on scroll position
      window.addEventListener('scroll', () => {
        if (window.scrollY > 750) {
          moveToTopButton.classList.remove('opacity-0', 'invisible');
          moveToTopButton.classList.add('opacity-100', 'visible');
        } else {
          moveToTopButton.classList.add('opacity-0', 'invisible');
          moveToTopButton.classList.remove('opacity-100', 'visible');
        }
      });

      // Scroll to top when clicked
      moveToTopButton.addEventListener('click', () => {
        window.scrollTo({
          top: 0,
          behavior: 'smooth'
        });
      });
    }
  });
</script>