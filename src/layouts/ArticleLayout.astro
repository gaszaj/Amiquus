---
import BaseLayout from './BaseLayout.astro';

export interface Props {
  title: string;
  description?: string;
  publishDate: string;
  updateDate?: string;
  author: {
    name: string;
    profileUrl: string;
    image: string;
  };
  category: string;
  headings: Array<{
    depth: number;
    slug: string;
    text: string;
  }>;
}

const {
  title,
  description,
  publishDate,
  updateDate,
  author,
  category,
  headings = []
} = Astro.props;

// Format dates
const formatDate = (dateString: string) => {
  return new Date(dateString).toLocaleDateString('sl-SI', {
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  });
};

// Filter to only include h2 and h3 headings for the TOC
const tocHeadings = headings.filter(heading => heading.depth >= 2 && heading.depth <= 3);

// Mock related articles data
const allArticles = [
  {
    title: "Varnost, oznaƒçevanje in opozarjanje pri teka≈°kih dogodkih",
    url: "/articles/safety-signs-visibility-night",
    date: "2025-03-15"
  },
  {
    title: "Varnost, oznaƒçevanje in opozarjanje pri ≈°portnih dogodkih",
    url: "/articles/eu-regulations-road-warning-systems",
    date: "2025-03-10"
  },
  {
    title: "Varnost, oznaƒçevanje in opozarjanje pri kolesarskih dirkah",
    url: "/articles/maintain-triopan-warning-signs",
    date: "2025-03-05"
  },
  {
    title: "Varnost, oznaƒçevanje in opozarjanje pri ≈°portnih turnirjih",
    url: "/articles/warning-signs-construction-sites",
    date: "2025-02-28"
  },
  {
    title: "Varnost, oznaƒçevanje in opozarjanje pri ≈°portnih dnevih",
    url: "/articles/event-safety-warning-systems",
    date: "2025-02-20"
  },
  {
    title: "Varnost, oznaƒçevanje in opozarjanje pri ≈°olskih tekmovanjih",
    url: "/articles/highway-work-zone-safety",
    date: "2025-02-15"
  },
  {
    title: "Varnost, oznaƒçevanje in opozarjanje pri javnih prireditvah",
    url: "/articles/emergency-response-warning-systems",
    date: "2025-02-10"
  },
  {
    title: "Varnost, oznaƒçevanje in opozarjanje pri ≈°portnih objektih",
    url: "/articles/safety-sign-technology-innovation",
    date: "2025-02-05"
  }
];

// Filter out current article and get related ones
const relatedArticles = allArticles
  .filter(article => article.title !== title)
  .slice(0, 9);

// Format date for related articles
const formatRelatedDate = (dateString: string) => {
  return new Date(dateString).toLocaleDateString('en-US', {
    year: 'numeric',
    month: 'short',
    day: 'numeric'
  });
};
---

<BaseLayout title={title} description={description}>
  <!-- Hero Section with Dark Background -->
  <div class="bg-black text-white py-12">
    <div class="container mx-auto px-4">
      <div class="max-w-3xl animate-fade-in">
        <h1 class="text-4xl md:text-5xl font-bold mb-4">{title}</h1>
        
        {description && (
          <p class="text-xl text-gray-300 mb-6">{description}</p>
        )}
        
        <!-- Author info with improved responsive layout -->
        <div class="flex flex-col sm:flex-row flex-wrap gap-2 sm:items-center">
          <div class="flex items-center">
            <span class="text-gray-300 mr-2">ƒålanek je pripravil:</span>
            <a href={author.profileUrl} class="flex items-center group">
              <img 
                src={author.image} 
                alt={author.name} 
                class="w-10 h-10 rounded-full mr-3" 
              />
              <span class="text-white group-hover:text-signal-green transition-colors">
                {author.name}
              </span>
            </a>
          </div>
          <div class="flex items-center">
            <span class="hidden sm:inline mx-2 text-gray-300">‚Ä¢</span>
            <span class="text-gray-300">Objavljeno: {formatDate(publishDate)}</span>
          </div>
          {updateDate && (
            <div class="flex items-center">
              <span class="hidden sm:inline mx-2 text-gray-300">‚Ä¢</span>
              <span class="text-gray-300">
                Posodobljeno: {formatDate(updateDate)}
              </span>
            </div>
          )}
        </div>
      </div>
    </div>
  </div>

  <div class="container mx-auto px-4 py-8">
    <div class="flex flex-col lg:flex-row gap-8">
      <!-- Left Sidebar - Table of Contents -->
      <aside class="lg:w-1/5">
        <div class="sticky top-24">
          {tocHeadings.length > 0 && (
            <nav class="bg-white rounded-lg shadow-sm p-4 border border-gray-100">
              <h2 class="text-lg font-semibold text-signal-dark mb-2 pb-2 border-b">Na tej strani</h2>
              <ul class="space-y-1">
                {tocHeadings.map(heading => (
                  <li class={`${heading.depth === 2 ? 'mt-2 first:mt-0' : 'ml-3'}`}>
                    <a 
                      href={`#${heading.slug}`}
                      class={`toc-link block py-1.5 px-2 rounded transition-colors text-sm
                        ${heading.depth === 2 
                          ? 'text-signal-dark font-medium hover:bg-gray-50 border-l-2 border-transparent' 
                          : 'text-signal-gray hover:text-signal-green'}`}
                    >
                      {heading.text}
                    </a>
                  </li>
                ))}
              </ul>
            </nav>
          )}
        </div>
      </aside>

      <!-- Main Article Content -->
      <div class="lg:w-3/5">
        <div class="prose prose-lg max-w-none">
          <slot />
        </div>

        <!-- Editorial Policy Section -->
        <div class="bg-black text-white rounded-xl p-8 my-12">
          <h3 class="text-2xl font-bold mb-4">Uredni≈°ka politika</h3>
          <p class="text-gray-300 mb-6">
            Na≈°i ƒçlanki so skrbno pripravljeni in preverjeni s strani strokovnjakov. Preberite na≈°o uredni≈°ko politiko za veƒç informacij o na≈°em procesu.
          </p>
          <a 
            href="/si/uredniska-politika" 
            class="inline-block bg-signal-green text-black font-semibold px-6 py-3 rounded-lg hover:bg-[#a5d429] transition-colors"
          >
            Preberite veƒç ‚Üí
          </a>
        </div>

        <div class="bg-red-50 border border-red-100 rounded-xl p-6 mt-6">
          <p class="text-red-800 text-sm">
            Vsebina tega ƒçlanka je zgolj informativne narave in ne predstavlja uradnih navodil. Za toƒçne podatke o varnostnih zahtevah se posvetujte s pristojnimi institucijami.
          </p>
        </div>

        <!-- Related Articles Section -->
        <div class="border-t border-gray-200 pt-12 mt-12">
          <h2 class="text-2xl font-bold mb-8">Sorodni ƒçlanki</h2>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            {relatedArticles.map(article => (
              <article class="bg-white rounded-xl shadow-sm p-6 border border-gray-100">
                <h3 class="font-semibold text-lg mb-2">
                  <a href={article.url} class="text-signal-dark hover:text-signal-green transition-colors">
                    {article.title}
                  </a>
                </h3>
                <p class="text-signal-gray text-sm">
                  {formatRelatedDate(article.date)}
                </p>
              </article>
            ))}
          </div>
        </div>
      </div>

      <!-- Right Sidebar -->
      <aside class="lg:w-1/5">
        <div class="sticky top-24 space-y-6">
          <!-- Need Help Box -->
          <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-100">
            <h3 class="text-xl font-semibold text-signal-dark mb-3">Potrebujete pomoƒç?</h3>
            <p class="text-signal-gray mb-4">
              Kontaktirajte na≈°e strokovno osebje, ki vam bo pomagalo pri ustreznem zavarovanju obmoƒçja.
            </p>
            <a 
              href="mailto:support@eu-signal.com" 
              class="block bg-black text-signal-green border border-signal-green text-center font-medium py-3 px-4 rounded-lg hover:bg-signal-green hover:text-black transition-all"
            >
              Vpra≈°ajte nas
            </a>
          </div>
        </div>
      </aside>
    </div>
  </div>
</BaseLayout>

<style>
  .toc-link.active {
    color: var(--signal-green);
    background-color: #f0f9ff;
    font-weight: 600;
  }

  .toc-link.active:where([class*="border-l-4"]) {
    border-left-color: var(--signal-green);
  }

  /* Custom styles for banners */
  :global(.fear-banner) {
    @apply bg-red-50 border border-red-100 rounded-xl p-6 my-8 flex items-center;
  }

  :global(.fear-banner::before) {
    content: "‚ö†Ô∏è";
    @apply text-2xl mr-4;
  }

  :global(.helpful-banner) {
    @apply bg-green-50 border border-green-100 rounded-xl p-6 my-8 flex items-center;
  }

  :global(.helpful-banner::before) {
    content: "üí°";
    @apply text-2xl mr-4;
  }

  /* FAQ section styles */
  :global(.faq-section) {
    @apply bg-gray-50 rounded-xl p-6 my-8;
  }

  :global(.faq-section h2) {
    @apply text-2xl font-bold mb-6;
  }

  :global(.faq-item) {
    @apply mb-4;
  }

  :global(.faq-question) {
    @apply font-semibold text-lg mb-2;
  }

  :global(.faq-answer) {
    @apply text-signal-gray;
  }

  /* Product grid styles */
  :global(.product-grid) {
    @apply grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 my-8;
  }

  :global(.product-card) {
    @apply bg-white rounded-lg shadow-md overflow-hidden border border-gray-200;
  }

  :global(.product-card img) {
    @apply w-full h-48 object-contain p-4;
  }

  :global(.product-card-content) {
    @apply p-4;
  }

  :global(.product-title) {
    @apply font-medium text-lg mb-4;
  }

  :global(.product-button) {
    @apply inline-block w-full bg-black text-signal-green border border-signal-green font-medium py-2 px-4 rounded-md hover:bg-signal-green hover:text-black transition-all text-center;
  }

  /* Basic Signs Grid */
  :global(.basic-signs-grid) {
    @apply grid grid-cols-1 md:grid-cols-3 gap-6 my-8;
  }

  :global(.basic-signs-grid .product-card) {
    @apply bg-white rounded-lg shadow-md overflow-hidden border border-gray-200;
  }

  :global(.basic-signs-grid a) {
    @apply block w-full bg-black text-signal-green border border-signal-green font-medium py-2 px-4 rounded-md hover:bg-signal-green hover:text-black transition-all text-center;
  }
</style>

<script>
  // Highlight TOC items when scrolling to section
  document.addEventListener('DOMContentLoaded', () => {
    const headings = Array.from(document.querySelectorAll('h2[id], h3[id], h4[id]'));
    const tocLinks = Array.from(document.querySelectorAll('.toc-link'));
    
    if (headings.length && tocLinks.length) {
      const observerOptions = {
        rootMargin: '-100px 0px -60% 0px',
        threshold: 0
      };
      
      const headingObserver = new IntersectionObserver(entries => {
        entries.forEach(entry => {
          const id = entry.target.getAttribute('id');
          const tocLink = document.querySelector(`.toc-link[href="#${id}"]`);
          
          if (tocLink) {
            if (entry.isIntersecting) {
              // Remove active class from all links
              tocLinks.forEach(link => link.classList.remove('active'));
              // Add active class to current link
              tocLink.classList.add('active');
            }
          }
        });
      }, observerOptions);
      
      headings.forEach(heading => {
        headingObserver.observe(heading);
      });
    }
  });
</script>