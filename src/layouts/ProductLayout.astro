---
import BaseLayout from './BaseLayout.astro';
import { actions, isInputError } from 'astro:actions'; // Import Astro Actions utilities

export interface ProductSpecification {
  dimensions: string; material: string; weight: string; visibility: string; windResistance: string; setupTime: string;
}
export interface RelatedProductInfo {
  id: string; title: string; image: string; category: string; url: string;
}
export interface FaqItemData {
  question: string; answer: string;
}
export interface ProductLayoutStrings {
  techSpecTitle: string; techSpecDimensionsLabel: string; techSpecMaterialLabel: string; techSpecWeightLabel: string; techSpecVisibilityLabel: string; techSpecWindResistanceLabel: string; techSpecSetupTimeLabel: string;
  orderButtonText: string;
  orderFormTitle: string; orderFormSubtitleBase: string; orderFormNameLabel: string; orderFormNamePlaceholder: string; orderFormSurnameLabel: string; orderFormSurnamePlaceholder: string; orderFormCompanyLabel: string; orderFormCompanyPlaceholder: string; orderFormVatIdLabel: string; orderFormVatIdPlaceholder: string; orderFormStreetLabel: string; orderFormStreetPlaceholder: string; orderFormCityLabel: string; orderFormCityPlaceholder: string; orderFormZipLabel: string; orderFormZipPlaceholder: string; orderFormEmailLabel: string; orderFormEmailPlaceholder: string; orderFormPhoneLabel: string; orderFormPhonePlaceholder: string; orderFormQuantityLabel: string; orderFormQuantityDefaultOption: string; orderFormPaymentLabelBase: string; orderFormPaymentCod: string; orderFormPaymentPreInvoice: string; orderFormMessageLabel: string; orderFormMessagePlaceholder: string; orderFormTermsLabel: string; orderFormSubmitButtonText: string;
  faqSectionTitle: string; faqBackButtonText: string;
  relatedProductsTitle: string; relatedProductViewButtonText: string;
  customerSupportTitle: string; customerSupportEmail: string;
  validationNameRequired: string; validationSurnameRequired: string; validationStreetRequired: string; validationCityRequired: string; validationZipRequired: string; validationEmailRequired: string; validationEmailInvalid: string; validationPhoneRequired: string; validationQuantityRequired: string; validationPaymentRequired: string; validationTermsRequired: string;
  formSuccessMessage: string;
}
export interface Props {
  title: string; subtitle: string; description?: string; keywords?: string; price: string; image: string; specifications: ProductSpecification;
  relatedProducts: RelatedProductInfo[]; quantityOptions: number[]; faqItems: FaqItemData[];
  layoutStrings: ProductLayoutStrings;
  schema: object | null; 
  ogImage?: string;
}

const { title, subtitle, description, keywords, price, image, specifications, relatedProducts, quantityOptions, faqItems, layoutStrings, schema,  ogImage } = Astro.props;

const currentPageUrl = Astro.url.href; // Get current page URL

// Get the result of the form submission action
const submissionResult = await Astro.getActionResult(actions.submitOrder);

// Extract errors for easier use in the template
const formErrors: Record<string, string[] | undefined> = {};
let genericError: string | undefined = undefined;
let successMessage: string | undefined = undefined;

if (submissionResult) {
  if (submissionResult.error) {
    if (isInputError(submissionResult.error)) {
      // Zod validation errors per field
      for (const fieldName in submissionResult.error.fields) {
        formErrors[fieldName] = submissionResult.error.fields[fieldName];
      }
       // Check for pageUrl specific error if you want to display it, though it's hidden
      if (formErrors.pageUrl) {
        console.warn("Page URL validation error:", formErrors.pageUrl);
        // Potentially add to genericError or a specific dev-only message
      }
    } else {
      // Other ActionError (e.g., from Emailit API failure)
      genericError = submissionResult.error.message || "Pri≈°lo je do napake.";
    }
  } else if (submissionResult.data?.success) {
    // Use the potentially updated success message from the action
    successMessage = submissionResult.data.message || layoutStrings.formSuccessMessage;
  }
}

// Helper function to get the first error for a field
function getFieldError(fieldName: string): string | undefined {
  return formErrors[fieldName]?.[0];
}
---

<BaseLayout title={title} description={description} ogImage={ogImage} keywords={keywords} schema={schema}>
  <div class="container mx-auto px-4 py-8">
    <div class="flex flex-col lg:flex-row gap-8">
      <div class="lg:w-2/3">
        <h1 class="text-3xl font-bold text-signal-dark mb-6">{title}</h1>
        <div class="product-gallery mb-8">
          <div class="border-2 border-signal-green rounded-lg p-2">
            <img
            src={image}
            alt={title}
            class="w-full h-[350px] object-contain animate-fade-in"
            width="350"
            height="350"
            fetchpriority="high"
            />
          </div>
        </div>
        <p class="text-lg text-gray-600 mb-6">{subtitle}</p>

        <div class="lg:hidden mb-8">
          <div class="bg-black text-white rounded-lg shadow-sm p-6">
            <h3 class="text-lg font-semibold mb-4 text-white">{layoutStrings.techSpecTitle}</h3>
            <ul class="space-y-4">
              <li class="flex items-start">
                <span class="text-signal-green mr-3">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width={2} d="M3 5h11m-2 2l2-2l-2-2M5 3L3 5l2 2m14 3v11m-2-2l2 2l2-2m0-7l-2-2l-2 2M3 12a2 2 0 0 1 2-2h7a2 2 0 0 1 2 2v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" /></svg>
                </span>
                <div><span class="block font-medium text-white">{layoutStrings.techSpecDimensionsLabel}</span><span class="text-sm text-gray-300">{specifications.dimensions}</span></div>
              </li>
              <li class="flex items-start">
                <span class="text-signal-green mr-3">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width={2} d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" /></svg>
                </span>
                <div><span class="block font-medium text-white">{layoutStrings.techSpecMaterialLabel}</span><span class="text-sm text-gray-300">{specifications.material}</span></div>
              </li>
              <li class="flex items-start">
                <span class="text-signal-green mr-3">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 24 24"><path fill="currentColor" d="M12 7q.425 0 .713-.288T13 6t-.288-.712T12 5t-.712.288T11 6t.288.713T12 7m2.825 0h1.75q.75 0 1.3.5t.675 1.225l1.425 10q.125.9-.462 1.588T18 21H6q-.925 0-1.513-.687t-.462-1.588l1.425-10Q5.575 8 6.125 7.5t1.3-.5h1.75q-.075-.25-.125-.487T9 6q0-1.25.875-2.125T12 3t2.125.875T15 6q0 .275-.05.513T14.825 7"/></svg>
                </span>
                <div><span class="block font-medium text-white">{layoutStrings.techSpecWeightLabel}</span><span class="text-sm text-gray-300">{specifications.weight}</span></div>
              </li>
              <li class="flex items-start">
                <span class="text-signal-green mr-3">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width={2} d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width={2} d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" /></svg>
                </span>
                <div><span class="block font-medium text-white">{layoutStrings.techSpecVisibilityLabel}</span><span class="text-sm text-gray-300">{specifications.visibility}</span></div>
              </li>
              <li class="flex items-start">
                <span class="text-signal-green mr-3">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 512 512">
                    <defs>
                      <symbol id="meteoconsWind_mobile" viewBox="0 0 342 234">
                        <path fill="none" stroke="currentColor" stroke-dasharray="148" stroke-linecap="round" stroke-miterlimit="10" stroke-width="18" d="M264.2 21.3A40 40 0 1 1 293 89H9">
                          <animate attributeName="stroke-dashoffset" dur="7.2s" repeatCount="indefinite" values="0; 2960"/>
                        </path>
                        <path fill="none" stroke="currentColor" stroke-dasharray="110" stroke-linecap="round" stroke-miterlimit="10" stroke-width="18" d="M148.2 212.7A40 40 0 1 0 177 145H9">
                          <animate attributeName="stroke-dashoffset" dur="7.2s" repeatCount="indefinite" values="0; 1540"/>
                        </path>
                      </symbol>
                    </defs>
                    <use width="342" height="234" href="#meteoconsWind_mobile" transform="translate(85 139)"/>
                  </svg>
                </span>
                <div><span class="block font-medium text-white">{layoutStrings.techSpecWindResistanceLabel}</span><span class="text-sm text-gray-300">{specifications.windResistance}</span></div>
              </li>
              <li class="flex items-start">
                <span class="text-signal-green mr-3">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 24 24">
                    <path fill="currentColor" d="M12,1A11,11,0,1,0,23,12,11,11,0,0,0,12,1Zm0,20a9,9,0,1,1,9-9A9,9,0,0,1,12,21Z"/>
                    <rect width="2" height="7" x="11" y="6" fill="currentColor" rx="1">
                      <animateTransform attributeName="transform" dur="10.8s" repeatCount="indefinite" type="rotate" values="0 12 12;360 12 12"/>
                    </rect>
                    <rect width="2" height="9" x="11" y="11" fill="currentColor" rx="1">
                      <animateTransform attributeName="transform" dur="0.9s" repeatCount="indefinite" type="rotate" values="0 12 12;360 12 12"/>
                    </rect>
                  </svg>
                </span>
                <div><span class="block font-medium text-white">{layoutStrings.techSpecSetupTimeLabel}</span><span class="text-sm text-gray-300">{specifications.setupTime}</span></div>
              </li>
            </ul>
          </div>
        </div>

        <div class="product-details">
          <p class="text-2xl text-black font-semibold pl-4 pr-4 underline decoration-signal-green mb-4">{price}</p>
          <a href="#narocilnica" class="inline-block bg-black text-signal-green border border-signal-green font-semibold py-3 px-6 rounded-lg hover:bg-signal-green hover:text-black transition-colors mb-8">
            <span class="flex items-center">{layoutStrings.orderButtonText}<svg class="w-5 h-5 ml-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" /></svg></span>
          </a>
          <div class="prose max-w-none mb-8"><slot /></div>

          <section id="narocilnica" class="scroll-mt-24 mb-8">
            <div class="bg-white rounded-lg shadow-sm p-8 border-2 border-signal-green">
              <h2 class="text-2xl font-bold mb-6 text-black">{layoutStrings.orderFormTitle}</h2>
              <p class="text-signal-gray mb-6">{layoutStrings.orderFormSubtitleBase} {title}.</p>

              {successMessage && !submissionResult?.error && (
                <div class="p-4 mb-4 text-sm text-green-700 bg-green-100 rounded-lg" role="alert">
                  {successMessage}
                </div>
              )}

              {genericError && (
                <div class="p-4 mb-4 text-sm text-red-700 bg-red-100 rounded-lg" role="alert">
                  {genericError}
                </div>
              )}

              <form id="productOrderForm" method="POST" action={actions.submitOrder} class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <input type="hidden" name="productTitle" value={title} />
                <input type="hidden" name="pageUrl" value={currentPageUrl} />

                <div>
                  <label for="form-name" class="block text-sm font-medium text-signal-gray mb-1">{layoutStrings.orderFormNameLabel}</label>
                  <input id="form-name" type="text" name="Name" placeholder={layoutStrings.orderFormNamePlaceholder} class:list={["w-full px-3 py-2 border border-gray-300 rounded-md", { "border-red-500": getFieldError('Name') }]} required />
                  {getFieldError('Name') && <div class="text-red-500 text-sm mt-1">{getFieldError('Name')}</div>}
                  {!getFieldError('Name') && <div class="empty-feedback text-red-400 text-sm mt-1" style="display:none;">{layoutStrings.validationNameRequired}</div>}
                </div>
                <div>
                  <label for="form-surname" class="block text-sm font-medium text-signal-gray mb-1">{layoutStrings.orderFormSurnameLabel}</label>
                  <input id="form-surname" type="text" name="Last Name" placeholder={layoutStrings.orderFormSurnamePlaceholder} class:list={["w-full px-3 py-2 border border-gray-300 rounded-md", { "border-red-500": getFieldError('Last Name') }]} required />
                  {getFieldError('Last Name') && <div class="text-red-500 text-sm mt-1">{getFieldError('Last Name')}</div>}
                  {!getFieldError('Last Name') && <div class="empty-feedback text-red-400 text-sm mt-1" style="display:none;">{layoutStrings.validationSurnameRequired}</div>}
                </div>
                <div>
                  <label for="form-company" class="block text-sm font-medium text-signal-gray mb-1">{layoutStrings.orderFormCompanyLabel}</label>
                  <input id="form-company" type="text" name="Company" placeholder={layoutStrings.orderFormCompanyPlaceholder} class:list={["w-full px-3 py-2 border border-gray-300 rounded-md", { "border-red-500": getFieldError('Company') }]} />
                  {getFieldError('Company') && <div class="text-red-500 text-sm mt-1">{getFieldError('Company')}</div>}
                </div>
                <div>
                  <label for="form-vatid" class="block text-sm font-medium text-signal-gray mb-1">{layoutStrings.orderFormVatIdLabel}</label>
                  <input id="form-vatid" type="text" name="VAT ID" placeholder={layoutStrings.orderFormVatIdPlaceholder} class:list={["w-full px-3 py-2 border border-gray-300 rounded-md", { "border-red-500": getFieldError('VAT ID') }]} />
                  {getFieldError('VAT ID') && <div class="text-red-500 text-sm mt-1">{getFieldError('VAT ID')}</div>}
                </div>
                <div>
                  <label for="form-street" class="block text-sm font-medium text-signal-gray mb-1">{layoutStrings.orderFormStreetLabel}</label>
                  <input id="form-street" type="text" name="Street" placeholder={layoutStrings.orderFormStreetPlaceholder} class:list={["w-full px-3 py-2 border border-gray-300 rounded-md", { "border-red-500": getFieldError('Street') }]} required />
                  {getFieldError('Street') && <div class="text-red-500 text-sm mt-1">{getFieldError('Street')}</div>}
                  {!getFieldError('Street') && <div class="empty-feedback text-red-400 text-sm mt-1" style="display:none;">{layoutStrings.validationStreetRequired}</div>}
                </div>
                <div>
                  <label for="form-city" class="block text-sm font-medium text-signal-gray mb-1">{layoutStrings.orderFormCityLabel}</label>
                  <input id="form-city" type="text" name="Location" placeholder={layoutStrings.orderFormCityPlaceholder} class:list={["w-full px-3 py-2 border border-gray-300 rounded-md", { "border-red-500": getFieldError('Location') }]} required />
                  {getFieldError('Location') && <div class="text-red-500 text-sm mt-1">{getFieldError('Location')}</div>}
                  {!getFieldError('Location') && <div class="empty-feedback text-red-400 text-sm mt-1" style="display:none;">{layoutStrings.validationCityRequired}</div>}
                </div>
                <div>
                  <label for="form-zip" class="block text-sm font-medium text-signal-gray mb-1">{layoutStrings.orderFormZipLabel}</label>
                  <input id="form-zip" type="text" name="Postal Code" placeholder={layoutStrings.orderFormZipPlaceholder} class:list={["w-full px-3 py-2 border border-gray-300 rounded-md", { "border-red-500": getFieldError('Postal Code') }]} required />
                  {getFieldError('Postal Code') && <div class="text-red-500 text-sm mt-1">{getFieldError('Postal Code')}</div>}
                  {!getFieldError('Postal Code') && <div class="empty-feedback text-red-400 text-sm mt-1" style="display:none;">{layoutStrings.validationZipRequired}</div>}
                </div>
                <div>
                  <label for="form-email" class="block text-sm font-medium text-signal-gray mb-1">{layoutStrings.orderFormEmailLabel}</label>
                  <input id="form-email" type="email" name="email" placeholder={layoutStrings.orderFormEmailPlaceholder} class:list={["w-full px-3 py-2 border border-gray-300 rounded-md", { "border-red-500": getFieldError('email') }]} required />
                  {getFieldError('email') && <div class="text-red-500 text-sm mt-1">{getFieldError('email')}</div>}
                  {!getFieldError('email') && <> <div class="empty-feedback text-red-400 text-sm mt-1" style="display:none;">{layoutStrings.validationEmailRequired}</div> <div class="invalid-feedback text-red-400 text-sm mt-1" style="display:none;">{layoutStrings.validationEmailInvalid}</div> </>}
                </div>
                <div>
                  <label for="form-phone" class="block text-sm font-medium text-signal-gray mb-1">{layoutStrings.orderFormPhoneLabel}</label>
                  <input id="form-phone" type="tel" name="Telephone Number" placeholder={layoutStrings.orderFormPhonePlaceholder} class:list={["w-full px-3 py-2 border border-gray-300 rounded-md", { "border-red-500": getFieldError('Telephone Number') }]} required />
                  {getFieldError('Telephone Number') && <div class="text-red-500 text-sm mt-1">{getFieldError('Telephone Number')}</div>}
                  {!getFieldError('Telephone Number') && <div class="empty-feedback text-red-400 text-sm mt-1" style="display:none;">{layoutStrings.validationPhoneRequired}</div>}
                </div>
                <div>
                  <label for="form-quantity" class="block text-sm font-medium text-signal-gray mb-1">{layoutStrings.orderFormQuantityLabel}</label>
                  <select id="form-quantity" name="Quantity" class:list={["w-full px-3 py-2 border border-gray-300 rounded-md", { "border-red-500": getFieldError('Quantity') }]} required>
                    <option value="">{layoutStrings.orderFormQuantityDefaultOption}</option>
                    {quantityOptions.map(qty => <option value={String(qty)}>{qty}</option>)}
                  </select>
                  {getFieldError('Quantity') && <div class="text-red-500 text-sm mt-1">{getFieldError('Quantity')}</div>}
                  {!getFieldError('Quantity') && <div class="empty-feedback text-red-400 text-sm mt-1" style="display:none;">{layoutStrings.validationQuantityRequired}</div>}
                </div>
                <div class="md:col-span-2">
                  <label class="block text-sm font-medium text-signal-gray mb-1">{layoutStrings.orderFormPaymentLabelBase}{price} + DDV)*</label>
                  <div id="payment-group">
                    <label class="flex items-center">
                      <input id="payment-cod" type="radio" name="Payment" value="Cash on Delivery" class:list={["mr-2", { "border-red-500": getFieldError('Payment') }]} required />
                      <span>{layoutStrings.orderFormPaymentCod}</span>
                    </label>
                    <label class="flex items-center">
                      <input id="payment-preinvoice" type="radio" name="Payment" value="Proforma Invoice" class:list={["mr-2", { "border-red-500": getFieldError('Payment') }]} required />
                      <span>{layoutStrings.orderFormPaymentPreInvoice}</span>
                    </label>
                    {getFieldError('Payment') && <div class="text-red-500 text-sm mt-1">{getFieldError('Payment')}</div>}
                    {!getFieldError('Payment') && <div class="empty-feedback text-red-400 text-sm mt-1" style="display:none;">{layoutStrings.validationPaymentRequired}</div>}
                  </div>
                </div>
                <div class="md:col-span-2">
                  <label for="form-message" class="block text-sm font-medium text-signal-gray mb-1">{layoutStrings.orderFormMessageLabel}</label>
                  <textarea id="form-message" name="Message" rows="4" placeholder={layoutStrings.orderFormMessagePlaceholder} class:list={["w-full px-3 py-2 border border-gray-300 rounded-md", { "border-red-500": getFieldError('Message') }]}></textarea>
                  {getFieldError('Message') && <div class="text-red-500 text-sm mt-1">{getFieldError('Message')}</div>}
                </div>

                <div class="md:col-span-2 terms-wrapper">
                  <label for="form-terms" class="flex items-center">
                    <input id="form-terms" type="checkbox" name="Conditions" class:list={["mr-2", { "border-red-500": getFieldError('Conditions') }]} required />
                    <span class="text-sm">{layoutStrings.orderFormTermsLabel}</span>
                  </label>
                   {getFieldError('Conditions') && <div class="text-red-500 text-sm mt-1">{getFieldError('Conditions')}</div>}
                   {!getFieldError('Conditions') && <div class="empty-feedback text-red-400 text-sm mt-1" data-for="form-terms" style="display:none;">{layoutStrings.validationTermsRequired}</div>}
                </div>

                <div class="md:col-span-2">
                  <button type="submit" class="w-full bg-black text-signal-green border border-signal-green font-semibold py-3 px-6 rounded-lg hover:bg-signal-green hover:text-black transition-colors flex items-center justify-center relative overflow-hidden">
                    <span class="relative z-10">{layoutStrings.orderFormSubmitButtonText}</span>
                    <div class="absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent -translate-x-full animate-[shine_2s_infinite]"></div>
                  </button>
                </div>
                <div id="productOrderFormResult" class="md:col-span-2 mt-3 text-center">
                  {/* This div is now handled by the messages above the form */}
                </div>
              </form>
            </div>
          </section>

          <section class="bg-signal-green rounded-xl p-8 mt-12">
             <h2 class="text-2xl font-bold mb-6 text-black">{layoutStrings.faqSectionTitle}</h2>
            <div class="space-y-4">
              {faqItems.map((item) => (
                <details class="bg-signal-green rounded-lg group">
                  <summary class="p-4 cursor-pointer font-medium text-black hover:bg-[#a5d429] flex items-center justify-between rounded-t-lg border border-black group-open:rounded-b-none">
                    {item.question}
                    <svg class="w-6 h-6 transform transition-transform group-open:rotate-180" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg>
                  </summary>
                  <div class="p-4 text-white bg-black rounded-b-lg">{item.answer}</div>
                </details>
              ))}
            </div>
            <div class="text-center mt-8">
              <a href="#narocilnica" class="inline-flex items-center bg-white text-black border border-black font-medium py-3 px-6 rounded-lg hover:bg-black hover:text-white transition-colors">
                <svg class="w-5 h-5 mr-2 transition-colors" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M14.707 12.707a1 1 0 01-1.414 0L10 9.414l-3.293 3.293a1 1 0 01-1.414-1.414l4-4a1 1 0 011.414 0l4 4a1 1 0 010 1.414z" clip-rule="evenodd" /></svg>
                {layoutStrings.faqBackButtonText}
              </a>
            </div>
          </section>
        </div>

        {relatedProducts && relatedProducts.length > 0 && (
          <div class="mt-16">
            <h2 class="text-2xl font-bold mb-6">{layoutStrings.relatedProductsTitle}</h2>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
              {relatedProducts.map(product => (
                <div class="product-card bg-white rounded-lg shadow-md overflow-hidden border border-gray-200">
                  <a href={product.url} class="block relative overflow-hidden pb-[75%]">
                    <img
                      src={product.image}
                      alt={product.title}
                      loading="lazy"
                      class="absolute inset-0 w-full h-full object-cover object-center"
                      width="350"
                      height="350"
                      />
                  </a>
                  <div class="p-4">
                    <h3 class="font-medium text-lg mb-4"><a href={product.url} class="text-signal-dark hover:text-signal-green transition-colors">{product.title}</a></h3>
                    <a href={product.url} class="inline-block bg-white border border-signal-gray hover:border-signal-green text-signal-dark font-medium py-2 px-4 rounded-md transition-colors w-full text-center">{layoutStrings.relatedProductViewButtonText}</a>
                  </div>
                </div>
              ))}
            </div>
          </div>
        )}
      </div>

      <div class="hidden lg:block lg:w-1/3">
        <div class="bg-black text-white rounded-lg shadow-sm p-6 sticky top-20">
          <div class="mb-6">
            <h3 class="text-lg font-semibold mb-4 text-white">{layoutStrings.techSpecTitle}</h3>
            <ul class="space-y-4">
              <li class="flex items-start">
                <span class="text-signal-green mr-3">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width={2} d="M3 5h11m-2 2l2-2l-2-2M5 3L3 5l2 2m14 3v11m-2-2l2 2l2-2m0-7l-2-2l-2 2M3 12a2 2 0 0 1 2-2h7a2 2 0 0 1 2 2v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" /></svg>
                </span>
                <div><span class="block font-medium text-white">{layoutStrings.techSpecDimensionsLabel}</span><span class="text-sm text-gray-300">{specifications.dimensions}</span></div>
              </li>
              <li class="flex items-start">
                <span class="text-signal-green mr-3">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width={2} d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" /></svg>
                </span>
                <div><span class="block font-medium text-white">{layoutStrings.techSpecMaterialLabel}</span><span class="text-sm text-gray-300">{specifications.material}</span></div>
              </li>
              <li class="flex items-start">
                <span class="text-signal-green mr-3">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 24 24"><path fill="currentColor" d="M12 7q.425 0 .713-.288T13 6t-.288-.712T12 5t-.712.288T11 6t.288.713T12 7m2.825 0h1.75q.75 0 1.3.5t.675 1.225l1.425 10q.125.9-.462 1.588T18 21H6q-.925 0-1.513-.687t-.462-1.588l1.425-10Q5.575 8 6.125 7.5t1.3-.5h1.75q-.075-.25-.125-.487T9 6q0-1.25.875-2.125T12 3t2.125.875T15 6q0 .275-.05.513T14.825 7"/></svg>
                </span>
                <div><span class="block font-medium text-white">{layoutStrings.techSpecWeightLabel}</span><span class="text-sm text-gray-300">{specifications.weight}</span></div>
              </li>
              <li class="flex items-start">
                <span class="text-signal-green mr-3">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width={2} d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width={2} d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" /></svg>
                </span>
                <div><span class="block font-medium text-white">{layoutStrings.techSpecVisibilityLabel}</span><span class="text-sm text-gray-300">{specifications.visibility}</span></div>
              </li>
              <li class="flex items-start">
                <span class="text-signal-green mr-3">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 512 512">
                    <defs>
                      <symbol id="meteoconsWind_desktop" viewBox="0 0 342 234"> {/* Unique ID for second instance */}
                        <path fill="none" stroke="currentColor" stroke-dasharray="148" stroke-linecap="round" stroke-miterlimit="10" stroke-width="18" d="M264.2 21.3A40 40 0 1 1 293 89H9">
                          <animate attributeName="stroke-dashoffset" dur="7.2s" repeatCount="indefinite" values="0; 2960"/>
                        </path>
                        <path fill="none" stroke="currentColor" stroke-dasharray="110" stroke-linecap="round" stroke-miterlimit="10" stroke-width="18" d="M148.2 212.7A40 40 0 1 0 177 145H9">
                          <animate attributeName="stroke-dashoffset" dur="7.2s" repeatCount="indefinite" values="0; 1540"/>
                        </path>
                      </symbol>
                    </defs>
                    <use width="342" height="234" href="#meteoconsWind_desktop" transform="translate(85 139)"/>
                  </svg>
                </span>
                <div><span class="block font-medium text-white">{layoutStrings.techSpecWindResistanceLabel}</span><span class="text-sm text-gray-300">{specifications.windResistance}</span></div>
              </li>
              <li class="flex items-start">
                <span class="text-signal-green mr-3">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 24 24">
                    <path fill="currentColor" d="M12,1A11,11,0,1,0,23,12,11,11,0,0,0,12,1Zm0,20a9,9,0,1,1,9-9A9,9,0,0,1,12,21Z"/>
                    <rect width="2" height="7" x="11" y="6" fill="currentColor" rx="1">
                      <animateTransform attributeName="transform" dur="10.8s" repeatCount="indefinite" type="rotate" values="0 12 12;360 12 12"/>
                    </rect>
                    <rect width="2" height="9" x="11" y="11" fill="currentColor" rx="1">
                      <animateTransform attributeName="transform" dur="0.9s" repeatCount="indefinite" type="rotate" values="0 12 12;360 12 12"/>
                    </rect>
                  </svg>
                </span>
                <div><span class="block font-medium text-white">{layoutStrings.techSpecSetupTimeLabel}</span><span class="text-sm text-gray-300">{specifications.setupTime}</span></div>
              </li>
            </ul>
          </div>
          <div class="mb-6 border-t border-gray-700 pt-6">
            <h3 class="text-lg font-semibold mb-4 text-white">{layoutStrings.customerSupportTitle}</h3>
            <div class="flex items-center">
              <span class="text-signal-green mr-3"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 24 24"><mask id="lineMdEmailArrowRightFilled_customerSupport"><g fill="none" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path stroke-dasharray="64" stroke-dashoffset="64" d="M4 5h16c0.55 0 1 0.45 1 1v12c0 0.55 -0.45 1 -1 1h-16c-0.55 0 -1 -0.45 -1 -1v-12c0 -0.55 0.45 -1 1 -1Z"><animate fill="freeze" attributeName="stroke-dashoffset" dur="0.72s" values="64;0"/></path><path stroke-dasharray="24" stroke-dashoffset="24" d="M3 6.5l9 5.5l9 -5.5"><animate fill="freeze" attributeName="stroke-dashoffset" begin="0.72s" dur="0.24s" values="24;0"/></path><path fill="#fff" fill-opacity="0" stroke="none" d="M12 11l-8 -5h16l-8 5Z"><animate fill="freeze" attributeName="fill-opacity" begin="1.44s" dur="0.6s" values="0;1"/></path><path fill="#000" fill-opacity="0" stroke="none" d="M19 13c3.31 0 6 2.69 6 6c0 3.31 -2.69 6 -6 6c-3.31 0 -6 -2.69 -6 -6c0 -3.31 2.69 -6 6 -6Z"><set fill="freeze" attributeName="fill-opacity" begin="0.96s" to="1"/></path><path stroke-dasharray="6" stroke-dashoffset="6" d="M16 19h5"><animate fill="freeze" attributeName="stroke-dashoffset" begin="0.96s" dur="0.24s" values="6;0"/></path><path stroke-dasharray="4" stroke-dashoffset="4" d="M21 19l-2 2M21 19l-2 -2"><animate fill="freeze" attributeName="stroke-dashoffset" begin="1.2s" dur="0.24s" values="4;0"/></path></g></mask><rect width="24" height="24" fill="currentColor" mask="url(#lineMdEmailArrowRightFilled_customerSupport)"/></svg></span>
              <a href={`mailto:${layoutStrings.customerSupportEmail}`} class="text-signal-green hover:underline">{layoutStrings.customerSupportEmail}</a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</BaseLayout>

<style>
  @keyframes shine { 100% { transform: translateX(100%); } }
  .animate-\[shine\_2s\_infinite\] { animation: shine 2s infinite; }
  details > summary { list-style: none; }
  details > summary::-webkit-details-marker { display: none; }

  .invalid-feedback,
  .empty-feedback {
    display: none;
  }

  input:user-invalid ~ .empty-feedback,
  input:user-invalid ~ .invalid-feedback,
  select:user-invalid ~ .empty-feedback,
  input[type="radio"]:user-invalid ~ .empty-feedback,
  input[type="checkbox"]:user-invalid ~ .empty-feedback {
    display: block;
  }

  input:invalid,
  select:invalid,
  textarea:invalid {
  }
  input:invalid:focus,
  select:invalid:focus,
  textarea:invalid:focus {
  }
  .border-red-500 {
      border-color: #ef4444;
  }
</style>

<script>
  document.addEventListener('astro:page-load', () => {
    const detailsElements = document.querySelectorAll('details');
    detailsElements.forEach(detail => {
      detail.addEventListener('toggle', () => {
        const summary = detail.querySelector('summary');
        if (summary) {
          if (detail.open) summary.classList.add('group-open:rounded-b-none');
          else summary.classList.remove('group-open:rounded-b-none');
        }
      });
    });
  });
</script>