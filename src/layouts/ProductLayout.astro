---
import BaseLayout from './BaseLayout.astro';

export interface ProductSpecification {
  dimensions: string; material: string; weight: string; visibility: string; windResistance: string; setupTime: string;
}
export interface RelatedProductInfo {
  id: string; title: string; image: string; category: string; url: string;
}
export interface FaqItemData {
  question: string; answer: string;
}
export interface ProductLayoutStrings {
  techSpecTitle: string; techSpecDimensionsLabel: string; techSpecMaterialLabel: string; techSpecWeightLabel: string; techSpecVisibilityLabel: string; techSpecWindResistanceLabel: string; techSpecSetupTimeLabel: string;
  orderButtonText: string;
  orderFormTitle: string; orderFormSubtitleBase: string; orderFormNameLabel: string; orderFormNamePlaceholder: string; orderFormSurnameLabel: string; orderFormSurnamePlaceholder: string; orderFormCompanyLabel: string; orderFormCompanyPlaceholder: string; orderFormVatIdLabel: string; orderFormVatIdPlaceholder: string; orderFormStreetLabel: string; orderFormStreetPlaceholder: string; orderFormCityLabel: string; orderFormCityPlaceholder: string; orderFormZipLabel: string; orderFormZipPlaceholder: string; orderFormEmailLabel: string; orderFormEmailPlaceholder: string; orderFormPhoneLabel: string; orderFormPhonePlaceholder: string; orderFormQuantityLabel: string; orderFormQuantityDefaultOption: string; orderFormPaymentLabelBase: string; orderFormPaymentCod: string; orderFormPaymentPreInvoice: string; orderFormMessageLabel: string; orderFormMessagePlaceholder: string; orderFormTermsLabel: string; orderFormSubmitButtonText: string;
  faqSectionTitle: string; faqBackButtonText: string;
  relatedProductsTitle: string; relatedProductViewButtonText: string;
  customerSupportTitle: string; customerSupportEmail: string;
  validationNameRequired: string; validationSurnameRequired: string; validationStreetRequired: string; validationCityRequired: string; validationZipRequired: string; validationEmailRequired: string; validationEmailInvalid: string; validationPhoneRequired: string; validationQuantityRequired: string; validationPaymentRequired: string; validationTermsRequired: string; validationHCaptchaRequired: string;
  formSuccessMessage: string;
}
export interface Props {
  title: string; subtitle: string; description?: string; price: string; image: string; specifications: ProductSpecification;
  relatedProducts: RelatedProductInfo[]; quantityOptions: number[]; faqItems: FaqItemData[];
  layoutStrings: ProductLayoutStrings;
}

const { title, subtitle, description, price, image, specifications, relatedProducts, quantityOptions, faqItems, layoutStrings } = Astro.props;

const web3FormsAccessKey = "c8a73c2c-518e-4fd5-9331-2f35e2565315";
const emailSubject = `New Inquiry: ${title}`;
const replyToEmail = "nixo.zderic@gmail.com";
const fromName = "EUSIGNAL";
---

<BaseLayout title={title} description={description}>
  <div class="container mx-auto px-4 py-8">
    <div class="flex flex-col lg:flex-row gap-8">
      <div class="lg:w-2/3">
        <h1 class="text-3xl font-bold text-signal-dark mb-6">{title}</h1>
        <div class="product-gallery mb-8">
          <div class="border-2 border-signal-green rounded-lg p-8">
            <img src={image} alt={title} class="w-full h-[400px] object-contain animate-fade-in" />
          </div>
        </div>
        <p class="text-lg text-gray-600 mb-6">{subtitle}</p>

        <div class="lg:hidden mb-8">
          <div class="bg-black text-white rounded-lg shadow-sm p-6">
            <h3 class="text-lg font-semibold mb-4 text-white">{layoutStrings.techSpecTitle}</h3>
            <ul class="space-y-4">
              <li class="flex items-start"><span class="text-signal-green mr-3"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width={2} d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4" /></svg></span><div><span class="block font-medium text-white">{layoutStrings.techSpecDimensionsLabel}</span><span class="text-sm text-gray-300">{specifications.dimensions}</span></div></li>
              <li class="flex items-start"><span class="text-signal-green mr-3"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width={2} d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" /></svg></span><div><span class="block font-medium text-white">{layoutStrings.techSpecMaterialLabel}</span><span class="text-sm text-gray-300">{specifications.material}</span></div></li>
              <li class="flex items-start"><span class="text-signal-green mr-3"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width={2} d="M3 6l3 1m0 0l-3 9a5.002 5.002 0 006.001 0M6 7l3 9M6 7l6-2m6 2l3-1m-3 1l-3 9a5.002 5.002 0 006.001 0M18 7l3 9m-3-9l-6-2m0-2v2m0 16V5m0 16H9m3 0h3" /></svg></span><div><span class="block font-medium text-white">{layoutStrings.techSpecWeightLabel}</span><span class="text-sm text-gray-300">{specifications.weight}</span></div></li>
              <li class="flex items-start"><span class="text-signal-green mr-3"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width={2} d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width={2} d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" /></svg></span><div><span class="block font-medium text-white">{layoutStrings.techSpecVisibilityLabel}</span><span class="text-sm text-gray-300">{specifications.visibility}</span></div></li>
              <li class="flex items-start"><span class="text-signal-green mr-3"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width={2} d="M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg></span><div><span class="block font-medium text-white">{layoutStrings.techSpecWindResistanceLabel}</span><span class="text-sm text-gray-300">{specifications.windResistance}</span></div></li>
              <li class="flex items-start"><span class="text-signal-green mr-3"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width={2} d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" /></svg></span><div><span class="block font-medium text-white">{layoutStrings.techSpecSetupTimeLabel}</span><span class="text-sm text-gray-300">{specifications.setupTime}</span></div></li>
            </ul>
          </div>
        </div>

        <div class="product-details">
          <p class="text-2xl text-black font-semibold pl-4 pr-4 underline decoration-signal-green mb-4">{price}</p>
          <a href="#narocilnica" class="inline-block bg-black text-signal-green border border-signal-green font-semibold py-3 px-6 rounded-lg hover:bg-signal-green hover:text-black transition-colors mb-8">
            <span class="flex items-center">{layoutStrings.orderButtonText}<svg class="w-5 h-5 ml-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" /></svg></span>
          </a>
          <div class="prose max-w-none mb-8"><slot /></div>

          <section id="narocilnica" class="scroll-mt-24 mb-8">
            <div class="bg-white rounded-lg shadow-sm p-8 border-2 border-signal-green">
              <h2 class="text-2xl font-bold mb-6 text-black">{layoutStrings.orderFormTitle}</h2>
              <p class="text-signal-gray mb-6">{layoutStrings.orderFormSubtitleBase} {title}.</p>

              <form id="productOrderForm" action="https://api.web3forms.com/submit" method="POST" class="grid grid-cols-1 md:grid-cols-2 gap-4" data-astro-reload novalidate> {/* Removed needs-validation, will be added by JS */}
                <input type="hidden" name="access_key" value={web3FormsAccessKey} />
                <input type="hidden" name="subject" value={emailSubject} />
                <input type="hidden" name="from_name" value={fromName} />
                <input type="hidden" name="replyto" value={replyToEmail} />
                <input type="checkbox" name="botcheck" id="botcheck" class="hidden" style="display:none;" />

                <div>
                  <label for="form-name" class="block text-sm font-medium text-signal-gray mb-1">{layoutStrings.orderFormNameLabel}</label>
                  <input id="form-name" type="text" name="Name" placeholder={layoutStrings.orderFormNamePlaceholder} class="w-full px-3 py-2 border border-gray-300 rounded-md" required />
                  <div class="empty-feedback text-red-400 text-sm mt-1">{layoutStrings.validationNameRequired}</div>
                </div>
                <div>
                  <label for="form-surname" class="block text-sm font-medium text-signal-gray mb-1">{layoutStrings.orderFormSurnameLabel}</label>
                  <input id="form-surname" type="text" name="Last Name" placeholder={layoutStrings.orderFormSurnamePlaceholder} class="w-full px-3 py-2 border border-gray-300 rounded-md" required />
                  <div class="empty-feedback text-red-400 text-sm mt-1">{layoutStrings.validationSurnameRequired}</div>
                </div>
                <div>
                  <label for="form-company" class="block text-sm font-medium text-signal-gray mb-1">{layoutStrings.orderFormCompanyLabel}</label>
                  <input id="form-company" type="text" name="Company Not Required" placeholder={layoutStrings.orderFormCompanyPlaceholder} class="w-full px-3 py-2 border border-gray-300 rounded-md" />
                </div>
                <div>
                  <label for="form-vatid" class="block text-sm font-medium text-signal-gray mb-1">{layoutStrings.orderFormVatIdLabel}</label>
                  <input id="form-vatid" type="text" name="VAT ID Fill in Only by Company" placeholder={layoutStrings.orderFormVatIdPlaceholder} class="w-full px-3 py-2 border border-gray-300 rounded-md" />
                </div>
                <div>
                  <label for="form-street" class="block text-sm font-medium text-signal-gray mb-1">{layoutStrings.orderFormStreetLabel}</label>
                  <input id="form-street" type="text" name="Street" placeholder={layoutStrings.orderFormStreetPlaceholder} class="w-full px-3 py-2 border border-gray-300 rounded-md" required />
                  <div class="empty-feedback text-red-400 text-sm mt-1">{layoutStrings.validationStreetRequired}</div>
                </div>
                <div>
                  <label for="form-city" class="block text-sm font-medium text-signal-gray mb-1">{layoutStrings.orderFormCityLabel}</label>
                  <input id="form-city" type="text" name="Location" placeholder={layoutStrings.orderFormCityPlaceholder} class="w-full px-3 py-2 border border-gray-300 rounded-md" required />
                  <div class="empty-feedback text-red-400 text-sm mt-1">{layoutStrings.validationCityRequired}</div>
                </div>
                <div>
                  <label for="form-zip" class="block text-sm font-medium text-signal-gray mb-1">{layoutStrings.orderFormZipLabel}</label>
                  <input id="form-zip" type="text" name="Postal Code" placeholder={layoutStrings.orderFormZipPlaceholder} class="w-full px-3 py-2 border border-gray-300 rounded-md" required />
                  <div class="empty-feedback text-red-400 text-sm mt-1">{layoutStrings.validationZipRequired}</div>
                </div>
                <div>
                  <label for="form-email" class="block text-sm font-medium text-signal-gray mb-1">{layoutStrings.orderFormEmailLabel}</label>
                  <input id="form-email" type="email" name="Email Address" placeholder={layoutStrings.orderFormEmailPlaceholder} class="w-full px-3 py-2 border border-gray-300 rounded-md" required />
                  <div class="empty-feedback text-red-400 text-sm mt-1">{layoutStrings.validationEmailRequired}</div>
                  <div class="invalid-feedback text-red-400 text-sm mt-1">{layoutStrings.validationEmailInvalid}</div>
                </div>
                <div>
                  <label for="form-phone" class="block text-sm font-medium text-signal-gray mb-1">{layoutStrings.orderFormPhoneLabel}</label>
                  <input id="form-phone" type="tel" name="Telephone Number" placeholder={layoutStrings.orderFormPhonePlaceholder} class="w-full px-3 py-2 border border-gray-300 rounded-md" required />
                  <div class="empty-feedback text-red-400 text-sm mt-1">{layoutStrings.validationPhoneRequired}</div>
                </div>
                <div>
                  <label for="form-quantity" class="block text-sm font-medium text-signal-gray mb-1">{layoutStrings.orderFormQuantityLabel}</label>
                  <select id="form-quantity" name="Quantity" class="w-full px-3 py-2 border border-gray-300 rounded-md" required>
                    <option value="">{layoutStrings.orderFormQuantityDefaultOption}</option>
                    {quantityOptions.map(qty => <option value={qty}>{qty}</option>)}
                  </select>
                  <div class="empty-feedback text-red-400 text-sm mt-1">{layoutStrings.validationQuantityRequired}</div>
                </div>
                <div class="md:col-span-2">
                  <label class="block text-sm font-medium text-signal-gray mb-1">{layoutStrings.orderFormPaymentLabelBase}{price} + DDV)*</label>
                  <div id="payment-group">
                    <label class="flex items-center">
                      <input id="payment-cod" type="radio" name="Payment" value="Cash on Delivery" class="mr-2" required />
                      <span>{layoutStrings.orderFormPaymentCod}</span>
                    </label>
                    <label class="flex items-center">
                      <input id="payment-preinvoice" type="radio" name="Payment" value="Proforma Invoice" class="mr-2" required />
                      <span>{layoutStrings.orderFormPaymentPreInvoice}</span>
                    </label>
                    <div class="empty-feedback text-red-400 text-sm mt-1">{layoutStrings.validationPaymentRequired}</div>
                  </div>
                </div>
                <div class="md:col-span-2">
                  <label for="form-message" class="block text-sm font-medium text-signal-gray mb-1">{layoutStrings.orderFormMessageLabel}</label>
                  <textarea id="form-message" name="Message" rows="4" placeholder={layoutStrings.orderFormMessagePlaceholder} class="w-full px-3 py-2 border border-gray-300 rounded-md"></textarea>
                </div>

                <div class="md:col-span-2 h-captcha-wrapper">
                    <div class="h-captcha" data-captcha="true"></div>
                    {/* hCaptcha error will be shown in productOrderFormResult or via border */}
                </div>
                
                <div class="md:col-span-2 terms-wrapper">
                  <label for="form-terms" class="flex items-center">
                    <input id="form-terms" type="checkbox" name="Conditions" required class="mr-2" />
                    <span class="text-sm">{layoutStrings.orderFormTermsLabel}</span>
                  </label>
                   <div class="empty-feedback text-red-400 text-sm mt-1" data-for="form-terms">{layoutStrings.validationTermsRequired}</div>
                </div>

                <div class="md:col-span-2">
                  <button type="submit" class="w-full bg-black text-signal-green border border-signal-green font-semibold py-3 px-6 rounded-lg hover:bg-signal-green hover:text-black transition-colors flex items-center justify-center relative overflow-hidden">
                    <span class="relative z-10">{layoutStrings.orderFormSubmitButtonText}</span>
                    <div class="absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent -translate-x-full animate-[shine_2s_infinite]"></div>
                  </button>
                </div>
                <div id="productOrderFormResult" class="md:col-span-2 mt-3 text-center"></div>
              </form>
            </div>
          </section>

          <section class="bg-signal-green rounded-xl p-8 mt-12">
             <h2 class="text-2xl font-bold mb-6 text-black">{layoutStrings.faqSectionTitle}</h2>
            <div class="space-y-4">
              {faqItems.map((item) => (
                <details class="bg-signal-green rounded-lg group">
                  <summary class="p-4 cursor-pointer font-medium text-black hover:bg-[#a5d429] flex items-center justify-between rounded-t-lg border border-black group-open:rounded-b-none">
                    {item.question}
                    <svg class="w-6 h-6 transform transition-transform group-open:rotate-180" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg>
                  </summary>
                  <div class="p-4 text-white bg-black rounded-b-lg">{item.answer}</div>
                </details>
              ))}
            </div>
            <div class="text-center mt-8">
              <a href="#narocilnica" class="inline-flex items-center bg-white text-black border border-black font-medium py-3 px-6 rounded-lg hover:bg-black hover:text-white transition-colors">
                <svg class="w-5 h-5 mr-2 transition-colors" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M14.707 12.707a1 1 0 01-1.414 0L10 9.414l-3.293 3.293a1 1 0 01-1.414-1.414l4-4a1 1 0 011.414 0l4 4a1 1 0 010 1.414z" clip-rule="evenodd" /></svg>
                {layoutStrings.faqBackButtonText}
              </a>
            </div>
          </section>
        </div>

        {relatedProducts && relatedProducts.length > 0 && (
          <div class="mt-16">
            <h2 class="text-2xl font-bold mb-6">{layoutStrings.relatedProductsTitle}</h2>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
              {relatedProducts.map(product => (
                <div class="product-card bg-white rounded-lg shadow-md overflow-hidden border border-gray-200">
                  <a href={product.url} class="block relative overflow-hidden pb-[75%]"><img src={product.image} alt={product.title} loading="lazy" class="absolute inset-0 w-full h-full object-cover object-center"/></a>
                  <div class="p-4">
                    <h3 class="font-medium text-lg mb-4"><a href={product.url} class="text-signal-dark hover:text-signal-green transition-colors">{product.title}</a></h3>
                    <a href={product.url} class="inline-block bg-white border border-signal-gray hover:border-signal-green text-signal-dark font-medium py-2 px-4 rounded-md transition-colors w-full text-center">{layoutStrings.relatedProductViewButtonText}</a>
                  </div>
                </div>
              ))}
            </div>
          </div>
        )}
      </div>

      <div class="hidden lg:block lg:w-1/3">
        <div class="bg-black text-white rounded-lg shadow-sm p-6 sticky top-20">
          <div class="mb-6">
            <h3 class="text-lg font-semibold mb-4 text-white">{layoutStrings.techSpecTitle}</h3>
            <ul class="space-y-4">
              <li class="flex items-start"><span class="text-signal-green mr-3"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width={2} d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4" /></svg></span><div><span class="block font-medium text-white">{layoutStrings.techSpecDimensionsLabel}</span><span class="text-sm text-gray-300">{specifications.dimensions}</span></div></li>
              <li class="flex items-start"><span class="text-signal-green mr-3"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width={2} d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" /></svg></span><div><span class="block font-medium text-white">{layoutStrings.techSpecMaterialLabel}</span><span class="text-sm text-gray-300">{specifications.material}</span></div></li>
              <li class="flex items-start"><span class="text-signal-green mr-3"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width={2} d="M3 6l3 1m0 0l-3 9a5.002 5.002 0 006.001 0M6 7l3 9M6 7l6-2m6 2l3-1m-3 1l-3 9a5.002 5.002 0 006.001 0M18 7l3 9m-3-9l-6-2m0-2v2m0 16V5m0 16H9m3 0h3" /></svg></span><div><span class="block font-medium text-white">{layoutStrings.techSpecWeightLabel}</span><span class="text-sm text-gray-300">{specifications.weight}</span></div></li>
              <li class="flex items-start"><span class="text-signal-green mr-3"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width={2} d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width={2} d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" /></svg></span><div><span class="block font-medium text-white">{layoutStrings.techSpecVisibilityLabel}</span><span class="text-sm text-gray-300">{specifications.visibility}</span></div></li>
              <li class="flex items-start"><span class="text-signal-green mr-3"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width={2} d="M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg></span><div><span class="block font-medium text-white">{layoutStrings.techSpecWindResistanceLabel}</span><span class="text-sm text-gray-300">{specifications.windResistance}</span></div></li>
              <li class="flex items-start"><span class="text-signal-green mr-3"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width={2} d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" /></svg></span><div><span class="block font-medium text-white">{layoutStrings.techSpecSetupTimeLabel}</span><span class="text-sm text-gray-300">{specifications.setupTime}</span></div></li>
            </ul>
          </div>
          <div class="mb-6 border-t border-gray-700 pt-6">
            <h3 class="text-lg font-semibold mb-4 text-white">{layoutStrings.customerSupportTitle}</h3>
            <div class="flex items-center">
              <span class="text-signal-green mr-3"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 20 20" fill="currentColor"><path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z" /><path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z" /></svg></span>
              <a href={`mailto:${layoutStrings.customerSupportEmail}`} class="text-signal-green hover:underline">{layoutStrings.customerSupportEmail}</a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script src="https://web3forms.com/client/script.js" async defer></script>
</BaseLayout>

<style>
  @keyframes shine { 100% { transform: translateX(100%); } }
  .animate-\[shine\_2s\_infinite\] { animation: shine 2s infinite; }
  details > summary { list-style: none; }
  details > summary::-webkit-details-marker { display: none; }

  .invalid-feedback, .empty-feedback { display: none; }
  
  .was-validated input:invalid ~ .empty-feedback,
  .was-validated input:invalid ~ .invalid-feedback,
  .was-validated select:invalid ~ .empty-feedback { display: block; }
  
  .was-validated input:not(:placeholder-shown):invalid ~ .empty-feedback { display: none; }
  .was-validated input:placeholder-shown:invalid ~ .invalid-feedback { display: none; }

  .was-validated .terms-wrapper input[type="checkbox"][required]:invalid ~ .empty-feedback[data-for="form-terms"] {
    display: block;
  }
   .was-validated #payment-group:has(input[type="radio"][required]:checked:invalid) ~ .empty-feedback, /* This is tricky, :has is not fully supported */
   .was-validated #payment-group.is-invalid .empty-feedback { /* We might need JS to add .is-invalid to payment-group */
      display: block;
   }

  .is-invalid, .was-validated :invalid {
    border-color: #dc3545 !important; /* Ensure override with important if needed */
  }
  .was-validated :invalid:focus {
    --tw-ring-color: #dc3545 !important;
    border-color: #dc3545 !important;
    box-shadow: 0 0 0 0.25rem rgba(220, 53, 69, 0.25) !important; /* Bootstrap-like focus */
  }
  .h-captcha-wrapper.h-captcha-invalid .h-captcha {
      outline: 2px solid #dc3545;
      border-radius: 0.25rem;
      padding: 2px; /* Add some padding so outline is visible */
  }
</style>

<script define:vars={{ 
    formSuccessMsg: layoutStrings.formSuccessMessage,
    validationHCaptchaRequiredMsg: layoutStrings.validationHCaptchaRequired
}}>
  document.addEventListener('astro:page-load', () => {
    // Handle FAQ details elements
    const detailsElements = document.querySelectorAll('details');
    detailsElements.forEach(detail => {
      detail.addEventListener('toggle', () => {
        const summary = detail.querySelector('summary');
        if (summary) {
          if (detail.open) summary.classList.add('group-open:rounded-b-none');
          else summary.classList.remove('group-open:rounded-b-none');
        }
      });
    });

    // Form elements
    const productOrderForm = document.getElementById("productOrderForm");
    const productOrderFormResult = document.getElementById("productOrderFormResult");
    const hCaptchaWrapper = productOrderForm?.querySelector('.h-captcha-wrapper');

    if (!productOrderForm || !productOrderFormResult) return;

    // Helper functions
    const showError = (message) => {
      productOrderFormResult.innerHTML = `<p class="text-red-500 font-semibold">${message}</p>`;
      setTimeout(() => {
        if (document.body.contains(productOrderFormResult)) {
          productOrderFormResult.innerHTML = "";
        }
      }, 7000);
    };

    const validateHCaptcha = () => {
      const hCaptchaResponseField = productOrderForm.querySelector('textarea[name="h-captcha-response"]');
      if (!hCaptchaResponseField?.value) {
        if (hCaptchaWrapper) {
          hCaptchaWrapper.classList.add('h-captcha-invalid');
        }
        return false;
      }
      return true;
    };

    const validateFormFields = () => {
      let isValid = true;
      const requiredFields = productOrderForm.querySelectorAll('[required]');
      
      requiredFields.forEach(field => {
        if (!field.checkValidity()) {
          field.classList.add('is-invalid');
          isValid = false;
        } else {
          field.classList.remove('is-invalid');
        }
      });

      // Special handling for radio buttons
      const paymentGroup = document.getElementById('payment-group');
      const paymentRadios = paymentGroup?.querySelectorAll('input[name="Payment"]');
      const isPaymentSelected = Array.from(paymentRadios || []).some(radio => radio.checked);
      
      if (!isPaymentSelected) {
        paymentGroup?.classList.add('is-invalid');
        isValid = false;
      } else {
        paymentGroup?.classList.remove('is-invalid');
      }

      return isValid;
    };

    const resetValidation = () => {
      productOrderForm.classList.remove("was-validated");
      const invalidFields = productOrderForm.querySelectorAll('.is-invalid');
      invalidFields.forEach(field => field.classList.remove('is-invalid'));
      if (hCaptchaWrapper) {
        hCaptchaWrapper.classList.remove('h-captcha-invalid');
      }
    };

    // Form submission handler
    productOrderForm.addEventListener("submit", async function (event) {
      event.preventDefault();
      productOrderFormResult.innerHTML = "";
      resetValidation();

      // Validate hCaptcha first
      if (!validateHCaptcha()) {
        showError(validationHCaptchaRequiredMsg);
        return;
      }

      // Validate form fields
      if (!validateFormFields()) {
        showError("Prosimo, izpolnite vsa označena obvezna polja.");
        return;
      }

      // All validations passed, proceed with submission
      productOrderFormResult.innerHTML = `<p class="text-gray-600">Pošiljanje...</p>`;

      try {
        const formData = new FormData(productOrderForm);
        const object = Object.fromEntries(formData);
        const json = JSON.stringify(object);

        const response = await fetch("https://api.web3forms.com/submit", {
          method: "POST",
          headers: { 
            "Content-Type": "application/json", 
            Accept: "application/json" 
          },
          body: json,
        });

        const jsonResponse = await response.json();

        if (response.status === 200 && jsonResponse.success) {
          productOrderFormResult.innerHTML = `<p class="text-green-600 text-lg font-semibold">${formSuccessMsg}</p>`;
          productOrderForm.reset();
          resetValidation();
          if (typeof window.hcaptcha !== 'undefined' && window.hcaptcha.reset) {
            window.hcaptcha.reset();
          }
        } else {
          showError(jsonResponse.message || "Prišlo je do napake na strežniku. Prosimo, poskusite znova.");
          if (jsonResponse.message?.toLowerCase().includes("captcha")) {
            if (hCaptchaWrapper) {
              hCaptchaWrapper.classList.add('h-captcha-invalid');
            }
            if (typeof window.hcaptcha !== 'undefined' && window.hcaptcha.reset) {
              window.hcaptcha.reset();
            }
          }
        }
      } catch (error) {
        console.error("Fetch error:", error);
        showError("Nekaj je šlo narobe! Preverite povezavo in poskusite znova.");
      }
    });

    // Add input event listeners to remove validation classes when user starts typing
    const inputs = productOrderForm.querySelectorAll('input, select, textarea');
    inputs.forEach(input => {
      input.addEventListener('input', () => {
        if (input.checkValidity()) {
          input.classList.remove('is-invalid');
        }
      });
    });
  });
</script>