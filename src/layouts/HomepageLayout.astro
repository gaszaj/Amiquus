---
import BaseLayout from './BaseLayout.astro';

// Define the shapes of the data this layout expects
interface HeroData {
  title: string;
  subtitle: string;
  ctaText: string;
  ctaLink: string;
  features: string[];
  socialProof: {
    text: string;
    rating: number;
    userPhotos: string[];
  };
}

interface Product {
  title: string;
  image: string;
  url: string;
}

interface FeatureItem {
  icon: string;
  title: string;
  description: string;
}

interface FaqItem {
  question: string;
  answer: string;
}

interface MarqueeItem {
  url: string;
  image: string;
  alt: string;
  imageWidth?: number;
  imageHeight?: number;
}

interface FormAlerts {
  invalidEmail: string;
  termsNotAccepted: string;
  submissionSuccess: string;
  submissionError: string;
}

interface Props {
  // Props for BaseLayout
  title: string;
  description?: string;

  // Props for page content
  heroData: HeroData;
  marqueeItems: MarqueeItem[];
  bestsellersSection: {
    title: string;
    products: Product[];
    productCtaText: string; // Added for the "Oddajte naročilo" button on product cards
  };
  featuresSection: {
    title: string;
    items: FeatureItem[];
  };
  institutionsSection: {
    title: string;
    items: string[];
  };
  faqSection: {
    title: string;
    items: FaqItem[];
  };
  contactSection: {
    title: string;
    subtitle: string;
    formLabels: {
      fullName: string;
      fullNamePlaceholder: string;
      email: string;
      emailPlaceholder: string;
      message: string;
      messagePlaceholder: string;
      terms: string;
      submitButton: string;
    };
  };
  formAlerts: FormAlerts; // Added for JavaScript alert messages
}

const { 
  title, 
  description,
  heroData,
  marqueeItems,
  bestsellersSection,
  featuresSection,
  institutionsSection,
  faqSection,
  contactSection,
  formAlerts // Destructure new prop for JS alerts
} = Astro.props;
---

<BaseLayout title={title} description={description}>
  <!-- Hero Section -->
  <section class="bg-black text-white py-12">
    <div class="container mx-auto px-4">
      <div class="max-w-3xl animate-fade-in">
        <h1 class="text-4xl md:text-5xl lg:text-6xl font-bold leading-tight mb-4">
          {heroData.title}
        </h1>
        <p class="text-xl md:text-2xl text-gray-300 mb-6 leading-relaxed">
          {heroData.subtitle}
        </p>
        
        <ul class="space-y-2 mb-6">
          {heroData.features.map(feature => (
            <li class="flex items-center gap-2">
              <span class="text-signal-green">✓</span>
              <span class="text-lg">{feature}</span>
            </li>
          ))}
        </ul>
        
        <div class="flex items-center gap-4 mb-8">
          <div class="flex -space-x-3">
            {heroData.socialProof.userPhotos.map(photo => (
              <img 
                src={photo} 
                alt="User" 
                class="w-10 h-10 rounded-full border-2 border-black"
              />
            ))}
          </div>
          <p class="text-lg text-signal-green">{heroData.socialProof.text}</p>
        </div>
        
        <a 
          href={heroData.ctaLink} 
          class="inline-block bg-signal-green text-black font-semibold px-8 py-3 hover:bg-[#a5d429] transition-colors"
        >
          {heroData.ctaText}
        </a>
      </div>
    </div>

    <!-- Marquee Section -->
    <div class="overflow-x-hidden width-100 relative mt-12">
      <div class="troznak-marquee-container">
        <div class="troznak-marquee">
          <div class="troznak-marquee__group">
            {[...Array(2)].map(() => (
              <div class="flex gap-4">
                {marqueeItems.map(item => (
                  <a href={item.url}>
                    <img src={item.image} alt={item.alt} />
                  </a>
                ))}
              </div>
            ))}
          </div>
          <div aria-hidden="true" class="troznak-marquee__group">
            {[...Array(2)].map(() => (
              <div class="flex gap-4">
                {marqueeItems.map(item => (
                  <a href={item.url}>
                    <img src={item.image} alt={item.alt} />
                  </a>
                ))}
              </div>
            ))}
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Bestsellers Section -->
  <section id="best-sellers" class="py-16 bg-white">
    <div class="container mx-auto px-4">
      <h2 class="text-3xl font-bold text-black mb-12 text-center">{bestsellersSection.title}</h2>
      <div class="grid grid-cols-2 lg:grid-cols-3 gap-2">
        {bestsellersSection.products.map(product => (
          <div class="bg-white border border-gray-100 overflow-hidden group">
            <a href={product.url} class="block">
              <img 
                src={product.image} 
                alt={product.title}
                class="w-full h-48 object-contain p-4"
              />
              <div class="p-4 border-t border-gray-100">
                <h3 class="font-medium text-black group-hover:text-signal-green transition-colors mb-4">
                  {product.title}
                </h3>
                <button class="w-full bg-black text-signal-green border border-signal-green py-2 px-4 hover:bg-signal-green hover:text-black transition-all">
                  {bestsellersSection.productCtaText}
                </button>
              </div>
            </a>
          </div>
        ))}
      </div>
    </div>
  </section>

  <!-- Features Section -->
  <section class="py-16 bg-gray-50">
    <div class="container mx-auto px-4">
      <h2 class="text-3xl font-bold text-black mb-12 text-center">{featuresSection.title}</h2>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
        {featuresSection.items.map(feature => (
          <div class="text-center p-6 bg-white rounded-lg shadow-sm">
            <div class="text-4xl mb-4">{feature.icon}</div>
            <h3 class="text-xl font-semibold mb-2">{feature.title}</h3>
            <p class="text-gray-600">{feature.description}</p>
          </div>
        ))}
      </div>
    </div>
  </section>

  <!-- Institutions Section -->
  <section class="py-16 bg-black">
    <div class="container mx-auto px-4">
      <h2 class="text-3xl font-bold text-white mb-12 text-center">
        {institutionsSection.title}
      </h2>
      <div class="flex flex-wrap justify-center items-center gap-12">
        {institutionsSection.items.map(institution => (
          <div class="text-xl font-medium text-signal-green hover:text-white transition-colors cursor-pointer">
            {institution}
          </div>
        ))}
      </div>
    </div>
  </section>

  <!-- FAQ Section -->
  <section class="py-16 bg-white">
    <div class="container mx-auto px-4">
      <h2 class="text-3xl font-bold text-black mb-4 text-center">{faqSection.title}</h2>
      <div class="max-w-3xl mx-auto space-y-4">
        {faqSection.items.map(item => (
          <details class="bg-gray-50 rounded-lg group">
            <summary class="p-4 cursor-pointer font-medium flex items-center justify-between">
              <span>{item.question}</span>
              <svg 
                class="w-5 h-5 transform transition-transform group-open:rotate-180" 
                fill="none" 
                stroke="currentColor" 
                viewBox="0 0 24 24"
              >
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
              </svg>
            </summary>
            <div class="p-4 pt-0 text-gray-600">
              {item.answer}
            </div>
          </details>
        ))}
      </div>
    </div>
  </section>

  <!-- Contact Section -->
  <section class="py-16 bg-gray-50">
    <div class="container mx-auto px-4">
      <h2 class="text-3xl font-bold text-black mb-4 text-center">{contactSection.title}</h2>
      <p class="text-center text-gray-600 mb-12 max-w-2xl mx-auto">
        {contactSection.subtitle}
      </p>

      <div class="max-w-2xl mx-auto">
        <form class="space-y-6">
          <div>
            <label class="block text-sm font-medium text-gray-600 mb-1">{contactSection.formLabels.fullName}</label>
            <input 
              type="text" 
              placeholder={contactSection.formLabels.fullNamePlaceholder}
              class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:border-signal-green focus:ring-1 focus:ring-signal-green" 
              required
            />
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-600 mb-1">{contactSection.formLabels.email}</label>
            <input 
              type="email" 
              placeholder={contactSection.formLabels.emailPlaceholder}
              class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:border-signal-green focus:ring-1 focus:ring-signal-green" 
              required
            />
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-600 mb-1">{contactSection.formLabels.message}</label>
            <textarea 
              rows="4" 
              placeholder={contactSection.formLabels.messagePlaceholder}
              class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:border-signal-green focus:ring-1 focus:ring-signal-green"
              required
            ></textarea>
          </div>
          <div class="flex items-center gap-2">
            <input type="checkbox" id="terms" required />
            <label for="terms" class="text-sm text-gray-600">
              {contactSection.formLabels.terms}
            </label>
          </div>
          <button 
            type="submit" 
            class="w-full bg-black text-signal-green border border-signal-green py-3 rounded-lg hover:bg-signal-green hover:text-black transition-all"
          >
            {contactSection.formLabels.submitButton}
          </button>
        </form>
      </div>
    </div>
  </section>
</BaseLayout>

<style>
.troznak-marquee-container {
  --space: clamp(1rem, 2vw, 2rem);
  --gap: var(--space);
  --duration: 25s;
  position: relative;
  width: 100%;
  max-width: 100vw;
  overflow-x: hidden;
  padding: 20px 0;
  box-sizing: border-box;
}

.troznak-marquee {
  display: flex;
  overflow: hidden;
  user-select: none;
  gap: var(--gap);
  width: 100%;
  margin: 0;
  padding: 0;
  mask-image: linear-gradient(
    to right,
    hsl(0 0% 0% / 0),
    hsl(0 0% 0% / 1) 10%,
    hsl(0 0% 0% / 1) 90%,
    hsl(0 0% 0% / 0)
  );
  -webkit-mask-image: linear-gradient(
    to right,
    hsl(0 0% 0% / 0),
    hsl(0 0% 0% / 1) 10%,
    hsl(0 0% 0% / 1) 90%,
    hsl(0 0% 0% / 0)
  );
}

.troznak-marquee-container:hover .troznak-marquee__group {
  animation-play-state: paused;
}

.troznak-marquee__group {
  flex-shrink: 0;
  display: flex;
  align-items: center;
  justify-content: space-around;
  gap: var(--gap);
  min-width: 100%;
  animation: troznak-scroll var(--duration) linear infinite;
  will-change: transform;
  animation-play-state: running;
}

.troznak-marquee__group img {
  max-width: clamp(8rem, 20vw, 20rem);
  aspect-ratio: 1;
  object-fit: cover;
  border-radius: 1rem;
  width: 100%;
  height: auto;
  flex-shrink: 0;
}

@keyframes troznak-scroll {
  0%{
    transform: translateX(0);
  }
  100% {
    transform: translateX(calc(-100% - var(--gap)));
  }
}

@media (prefers-reduced-motion: reduce) {
  .troznak-marquee__group {
    animation-play-state: paused;
  }
}

details > summary {
  list-style: none;
}
details > summary::-webkit-details-marker {
  display: none;
}
</style>

<script define:vars={{ alerts: formAlerts }}>
document.addEventListener('DOMContentLoaded', () => {
  const form = document.querySelector('form'); // Consider a more specific selector if multiple forms exist
  if (form) {
    form.addEventListener('submit', (e) => {
      e.preventDefault();
      
      const emailInput = form.querySelector('input[type="email"]');
      if (emailInput && !emailInput.value.includes('@')) {
        alert(alerts.invalidEmail); // Use passed alert message
        return;
      }

      const termsCheckbox = form.querySelector('#terms');
      if (termsCheckbox && !termsCheckbox.checked) {
        alert(alerts.termsNotAccepted); // Use passed alert message
        return;
      }

      try {
        // Form submission logic here (e.g., send data to a server)
        // For now, we just show the success message
        console.log('Form data would be submitted here.');
        alert(alerts.submissionSuccess); // Use passed alert message
        form.reset();
      } catch (error) {
        console.error('Form submission error:', error);
        alert(alerts.submissionError); // Use passed alert message
      }
    });
  }
});
</script>